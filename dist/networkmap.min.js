/*! networkmap 2014-02-21 */
"document"in self&&!("classList"in document.createElement("_"))&&function(a){"use strict";if("Element"in a){var b="classList",c="prototype",d=a.Element[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.getAttribute("class")||""),c=b?b.split(/\s+/):[],d=0,e=c.length;e>d;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0);while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b=arguments,c=0,d=b.length,e=!1;do{a=b[c]+"";var f=i(this,a);-1!==f&&(this.splice(f,1),e=!0)}while(++c<d);e&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),!c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){-2146823252===n.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(self);var networkMap=networkMap||{};networkMap.path=function(a){return a.path().attr({fill:"none",stroke:"#000"})},networkMap.find=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b.call(a,a[c],c,a))return a[c]},networkMap.isFunction=function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},networkMap.extend=function(){var a,b,c,d;for(a=[].slice.call(arguments),b=a.pop(),d=a.length-1;d>=0;d--)if(a[d])for(c in b)a[d].prototype[c]=b[c]},networkMap.Observable=function(){function a(a){return a.replace(/^on([A-Z])/,function(a,b){return b.toLowerCase()})}return{addEvent:function(b,c){return this.$events=this.$events||{},networkMap.isFunction(c)?(b=a(b),(this.$events[b]=this.$events[b]||[]).push(c),this):this},addEvents:function(a){for(var b in a)this.addEvent(b,a[b]);return this},fireEvent:function(b,c,d){this.$events=this.$events||{},b=a(b);var e=this.$events[b];return e?(c=c instanceof Array?c:[c],e.forEach(function(a){d?setTimeout(function(){a.apply(this,c)},d):a.apply(this,c)},this),this):this},removeEvent:function(b,c){b=a(b);var d=this.$events[b]||[],e=d.indexOf(c);return-1!==e&&d.splice(e,1),this},removeEvents:function(b){var c;if("object"==typeof b){for(c in b)this.removeEvent(c,b[c]);return this}b&&(b=a(b));for(c in this.$events)if(!b||b==c)for(var d=this.$events[c],e=d.length;e--;)e in d&&this.removeEvent(c,d[e]);return this}}}(),networkMap.keys=function(a){var b,c=[];if(a!==Object(a))return c;if(Object.keys)return Object.keys(a);for(b in a)hasOwnProperty.call(a,b)&&c.push(b);return c},networkMap.each=function(a,b,c){var d,e;if(null===a)return a;if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length)for(d=0,e=a.length;e>d;d++)b.call(c,a[d],d,a);else{var f=networkMap.keys(a);for(d=0,e=f.length;e>d;d++)b.call(c,a[f[d]],f[d],a)}return a},networkMap.defaults=function(a){return a=a||{},networkMap.each(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},networkMap.Options={setOptions:function(a){return this.options=networkMap.defaults(a,this.options),this}},networkMap.Mediator={subscribe:function(a,b){return networkMap.isFunction(b)?(this.$topics=this.$topics||{},(this.$topics[a]=this.$topics[a]||[]).push(b),this):this},publish:function(a,b,c){this.$topics=this.$topics||{};var d=this.$topics[a];return d?(b=b instanceof Array?b:[b],d.forEach(function(a){c?setTimeout(function(){a.apply(this,b)},c):a.apply(this,b)},this),this):this},unsubscribe:function(a,b){var c=this.$topics[a],d=c.indexOf(b);return-1!==d&&c.splice(d,1),this}},networkMap.toQueryString=function(a,b){var c=[];return networkMap.each(a,function(a,d){b&&(d=b+"["+d+"]");var e;switch(typeof a){case"object":e=networkMap.toQueryString(a,d);break;case"array":var f={};a.forEach(function(a,b){f[b]=a}),e=networkMap.toQueryString(f,d);break;default:e=d+"="+encodeURIComponent(a)}null!=a&&c.push(e)}),c.join("&")},networkMap.widget=networkMap.widget||{},networkMap.widget.IntegerInput=function(a,b,c){this.options={"class":"nm-input-integer"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.IntegerInput,networkMap.Observable),networkMap.extend(networkMap.widget.IntegerInput,networkMap.Options),networkMap.extend(networkMap.widget.IntegerInput,{createElements:function(a,b){return this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options.class),this.label=document.createElement("span"),this.label.textContent=a,this.input=document.createElement("input"),this.input.setAttribute("type","number"),this.input.setAttribute("value",b.value?b.value:b),b.inherited&&this.input.setAttribute("placeholder",b.inherited),this.input.addEventListener("change",function(a){this.fireEvent("change",[a,this])}.bind(this)),void 0!==this.options.min&&this.input.setAttribute("min",this.options.min),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.input),this},toElement:function(){return this.wrapper},value:function(){return""!==this.input.value?this.input.value:void 0}}),networkMap.widget=networkMap.widget||{},networkMap.widget.TextInput=function(a,b,c){this.options={"class":"nm-input-text",type:"text"},this.setOptions(c),this.$destroy=[],this.createElements(a,b)},networkMap.extend(networkMap.widget.TextInput,networkMap.Observable),networkMap.extend(networkMap.widget.TextInput,networkMap.Options),networkMap.extend(networkMap.widget.TextInput,{createElements:function(a,b){var c=this.wrapper=document.createElement("div");c.classList.add(this.options.class);var d=this.label=document.createElement("span");d.textContent=a;var e=this.input=document.createElement("input"),f=function(a){this.fireEvent("change",[a,this])}.bind(this);return e.setAttribute("type",this.options.type),e.setAttribute("value",b?b:""),this.$destroy.push({el:e,type:"change",fn:f}),e.addEventListener("change",f,!1),this.options.disabled===!0&&(this.input.disabled=!0),c.appendChild(d),c.appendChild(e),this},value:function(){return""!==this.input.value?this.input.value:void 0},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.ColorInput=function(a,b,c){this.options={"class":"nm-input-color"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.ColorInput,networkMap.Observable),networkMap.extend(networkMap.widget.ColorInput,networkMap.Options),networkMap.extend(networkMap.widget.ColorInput,{createElements:function(a,b){this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options.class),this.label=document.createElement("span"),this.label.textContent=a,this.div=document.createElement("div"),this.input=document.createElement("input"),this.input.setAttribute("type","color"),this.input.setAttribute("value",b),this.input.addEventListener("change",function(a){this.fireEvent("change",[a,this])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.div.appendChild(this.input),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.div)},value:function(){return this.input.value},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Accordion=function(a){this.options={"class":"nm-accordion"},this.setOptions(a),this.items=[],this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options.class)},networkMap.extend(networkMap.widget.Accordion,networkMap.Observable),networkMap.extend(networkMap.widget.Accordion,networkMap.Options),networkMap.extend(networkMap.widget.Accordion,{toElement:function(){return this.wrapper},add:function(a,b){var c=document.createElement("div");c.classList.add("nm-accordion-group","nm-accordion-open");var d=document.createElement("div");d.classList.add("nm-accordion-trigger","unselectable"),d.textContent=a;var e=new networkMap.widget.Accordion.Group(b);return c.appendChild(d),c.appendChild(e.toElement()),this.items.push(c),this.wrapper.appendChild(c),d.addEventListener("click",this.clickHandler.bind(this)),e},clickHandler:function(a){a.target.parentNode.classList.toggle("nm-accordion-open")}}),networkMap.widget.Accordion.Group=function(a){var b=this.list=document.createElement("ul");b.classList.add("nm-accordion-inner"),a&&a.id&&b.setAttribute("id",a.id)},networkMap.extend(networkMap.widget.Accordion.Group,{appendChild:function(a){return a.toElement?this.list.appendChild(a.toElement()):this.list.appendChild(a),this},toElement:function(){return this.list}}),networkMap.widget=networkMap.widget||{},networkMap.widget.List=function(a){this.options={"class":"nm-list"},this.listItems=[],this.setOptions(a),this.list=document.createElement("ul"),this.list.classList.add(this.options.class)},networkMap.extend(networkMap.widget.List,networkMap.Observable),networkMap.extend(networkMap.widget.List,networkMap.Options),networkMap.extend(networkMap.widget.List,{toElement:function(){return this.list},add:function(a,b){var c=new networkMap.widget.ListItem(a,b);return c.addEvent("remove",this.remove.bind(this)),this.listItems.push(c),this.list.appendChild(c.toElement()),c},remove:function(a){var b=this.listItems.indexOf(a);return this.listItems.splice(b,1),this}}),networkMap.widget.ListItem=function(a,b){if(this.options={"class":"nm-list-item",enableDelete:!1},this.setOptions(b),this.listItem=document.createElement("li"),this.listItem.classList.add(this.options.class),"string"==typeof a?this.listItem.textContent=a:this.listItem.appechChild(a),this.options.enableDelete){var c=document.createElement("span");c.textContent="x",c.classList.add("nm-list-item-delet","pull-right"),this.$remove=this.remove.bind(this),c.addEventListener("click",this.$remove)}},networkMap.extend(networkMap.widget.ListItem,networkMap.Observable),networkMap.extend(networkMap.widget.ListItem,networkMap.Options),networkMap.extend(networkMap.widget.ListItem,{remove:function(){return this.listItem.parentNode.removeChild(this.listItem),this.listItem.removeEventListener("click",this.$remove),delete this.listItem,this.fireEvent("remove",[this]),this},toElement:function(){return this.listItem}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Select=function(a,b,c){this.options={"class":"nm-input-select"},this.setOptions(c),this.$destroy=[],this.createElements(a),this.addOptions(b)},networkMap.extend(networkMap.widget.Select,networkMap.Observable),networkMap.extend(networkMap.widget.Select,networkMap.Options),networkMap.extend(networkMap.widget.Select,{createElements:function(a){var b=this.wrapper=document.createElement("div");b.classList.add(this.options.class);var c=this.label=document.createElement("span");c.textContent=a;var d=this.input=document.createElement("select"),e=function(a){this.fireEvent("select",[a,this])}.bind(this);this.$destroy.push({el:d,type:"change",fn:e}),d.addEventListener("change",e,!1),b.apppendChild(c),b.apppendChild(d)},addOptions:function(a){a.forEach(function(a){this.addOption(a)}.bind(this))},addOption:function(a,b){b=b||{};var c=document.createElement("option");return c.settAttribute("value",b.value?b.value:a),c.textContent=a,c.selected=b.selected,this.input.apppendChild(c),c},value:function(){return this.getSelected()},getSelected:function(){return-1!==this.input.selectedIndex?this.input.options[this.input.selectedIndex].value:null},clearOptions:function(){for(;this.input.firstChild;)this.input.removeChild(this.input.firstChild);return this},toElement:function(){return this.wrapper},toString:function(){return-1!==this.input.selectedIndex?this.input.options[this.input.selectedIndex]:null}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Modal=function(a){this.options={"class":"modal",title:"",content:"",footer:"",type:"alert"},this.setOptions(a),this.$destroy=[],this.buildUI()},networkMap.extend(networkMap.widget.Modal,networkMap.Observable),networkMap.extend(networkMap.widget.Modal,networkMap.Options),networkMap.extend(networkMap.widget.Modal,{buildUI:function(){var a=this.modal=document.createElement("div");a.classList.add("modal","hide","fade","in"),a.style.zIndex=1e6;var b=this.header=document.createElement("div");b.classList.add("modal-header");var c=this.closeButton=document.createElement("button"),d=this._close.bind(this);c.classList.add("close"),c.innerHTML="&times;",this.$destroy.push({el:c,type:"click",fn:d}),c.addEventListener("click",d,!1),b.appendChild(c);var e=this.title=document.createElement("h3");e.innerHTML=this.options.title,b.appendChild(e);var f=this.body=document.createElement("div");f.classList.add("modal-body"),f.innerHTML=this.options.content;var g=this.footer=document.createElement("div");return g.classList.add("modal-footer"),g.innerHTML=this.options.footer,a.appendChild(b),a.appendChild(f),a.appendChild(g),this},alert:function(a,b){b=b||{},this.body.innerHTML=a,this.title.innerHTML=b.title?b.title:"Alert";var c=this.btn=document.createElement("a"),d=this.destroy.bind(this);return c.setAttribute("href","#"),c.classList.add("btn"),c.textContent=b.button?b.button:"Ok",this.$destroy.push({el:c,type:"click",fn:d}),c.addEventListener("click",d,!1),this.footer.appendChild(c),document.body.appendChild(this.modal),this.show()},confirm:function(a,b){b=b||{},this.body.innerHTML=a,this.title.innerHTML=b.title?b.title:"Alert";var c=document.createElement("a"),d=this._cancel.bind(this);c.setAttribute("href","#"),c.classList.add("btn"),c.textContent=b.button?b.button:"Ok",this.$destroy.push({el:c,type:"click",fn:d}),c.addEventListener("click",d,!1),this.footer.appendChild(c);var e=document.createElement("a"),f=this._cancel.bind(this);return e.setAttribute("href","#"),e.classList.add("btn"),e.textContent=b.button?b.button:"Ok",this.$destroy.push({el:e,type:"click",fn:f}),e.addEventListener("click",f,!1),this.footer.appendChild(e),document.body.appendChild(this.modal),this.show()},show:function(){return this.modal.style.display="block",this},destroy:function(){return this.modal.parentNode.removeChild(this.modal),this.$destroy.forEach(function(a){a.el.removeEventListener(a.type,a.fn,!1)}),this.$destroy.length=0,this},_close:function(a){this.fireEvent("close",[a]),this.destroy()},_ok:function(a){this.fireEvent("ok",[a]),this.destroy()},_cancel:function(a){this.fireEvent("cancel",[a]),this.destroy()}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Checkbox=function(a,b,c){this.options={"class":"nm-checkbox",type:"checkbox"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.Checkbox,networkMap.Observable),networkMap.extend(networkMap.widget.Checkbox,networkMap.Options),networkMap.extend(networkMap.widget.Checkbox,{createElements:function(a,b){return this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options.class),this.label=document.createElement("span"),this.label.textContent=a,this.input=document.createElement("input"),this.input.setAttribute("type",this.options.type),this.input.checked=b,this.input.addEventListener("change",function(a){this.fireEvent("change",[a,this])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.input),this},toElement:function(){return this.wrapper},value:function(){return this.input.value},isChecked:function(){return this.input.checked}}),networkMap.widget=networkMap.widget||{},networkMap.widget.GridInput=function(a,b,c){this.options={"class":"nm-input-snap",type:"snap"},this.setOptions(c),this.createElements(a,b)},networkMap.extend(networkMap.widget.GridInput,networkMap.Observable),networkMap.extend(networkMap.widget.GridInput,networkMap.Options),networkMap.extend(networkMap.widget.GridInput,{createElements:function(a,b){this.wrapper=document.createElement("div"),this.wrapper.classList.add(this.options.class),this.label=document.createElement("span"),this.label.textContent=a,this.check=document.createElement("input"),this.check.setAttribute("type","checkbox"),this.check.checked=b.enabled,this.check.addEventListener("change",function(a){this.x.input.disabled=!this.check.checked,this.y.input.disabled=!this.check.checked,a.value=this.value(),this.fireEvent("change",[a])}.bind(this)),this.x=this.$createInputs("x",b.grid.x,b.enabled),this.y=this.$createInputs("y",b.grid.y,b.enabled),this.wrapper.appendChild(this.label),this.wrapper.appendChild(this.check),this.wrapper.appendChild(this.x.label),this.wrapper.appendChild(this.x.input),this.wrapper.appendChild(this.y.label),this.wrapper.appendChild(this.y.input)},$createInputs:function(a,b,c){var d={};return d.label=document.createElement("span"),d.label.textContent=a,d.input=document.createElement("input"),d.input.setAttribute("type","number"),d.input.setAttribute("value",b?b:1),d.input.setAttribute("min",1),d.input.setAttribute("max",50),d.input.disabled=!c,d.input.addEventListener("change",function(a){a.value=this.value(),this.fireEvent("change",[a,this])}.bind(this)),d},value:function(){return{enabled:this.check.checked,grid:{x:parseInt(this.x.input.value,10),y:parseInt(this.y.input.value,10)}}},toElement:function(){return this.wrapper}}),networkMap.Properties=function(a,b){this.properties=a||{},this.$change=[],this.setDefaults(b)},networkMap.extend(networkMap.Properties,networkMap.Observable),networkMap.extend(networkMap.Properties,{get:function(a,b){for(var c=this.properties,d=0,e=a.split("."),f=e.length;f>d&&c&&"object"==typeof c;d++)c=c[e[d]];return b===!0?{value:c,inherited:this.defaults?this.defaults.get(a):void 0}:(void 0===c&&void 0!==this.defaults&&(c=this.defaults.get(a)),c)},set:function(a,b){return this.$change.length=0,1===arguments.length&&arguments[0].constructor===Object?networkMap.each(arguments[0],this.$set,this):this.$set(b,a),this.fireEvent("change",[this.$change]),this},$set:function(a,b){var c={key:b,value:a,oldValue:this.properties[b]};return this.properties[b]=a,this.$change.push(c),c},unset:function(a){var b=this.properties[a];return delete this.properties[a],this.fireEvent("change",[a,v,b]),this},load:function(a){var b=[],c=this.properties;return networkMap.each(a,function(a,d){b.push({key:a,value:d,oldValue:c[a]})}),this.properties=a,this.$change=b,this.fireEvent("change",[b]),this},extract:function(){return this.properties},setDefaults:function(a){this.defaults=a||void 0,this.defaults&&this.defaults.addEvent("change",function(a){this.fireEvent("change",[a])}.bind(this))},configuration:function(a){return a=a||{},void 0===this.defaults?networkMap.defaults(a,this.properties):networkMap.defaults(a,this.properties,this.defaults.configuration())}}),networkMap.datasource=networkMap.datasource||{},networkMap.registerDatasource=function(a,b){networkMap.datasource[a]=function(a,c){"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]),b(a,c)}},networkMap.registerDatasource("simulate",function(a,b){b.forEach(function(b){var c=Math.random();b.callback({url:a,request:b.link,value:c,realValue:Math.round(100*c)+"Mbps"})})}),networkMap.events=networkMap.events||{click:function(a,b){b.options.events.click.href&&(window.location.href=b.options.events.click.href)},hover:function(a,b,c){c.set("text",b.options.name)},mouseover:function(){},mouseout:function(){}},networkMap.registerEvent=function(a,b){if(!networkMap.events[a])throw"Invalid event: "+a+" is not an registered event";"click"===a?networkMap.events[a]=function(a,c){b(a,c)}:"hover"===a?(networkMap.events.mouseover=function(a,c){var d=document.getElementById("nm-active-hover");if(a.target.instance.attr("id"),d){if(!d||d.retrieve("id")===a.target.instance.attr("id"))return d.store("keep",!0),void 0;d.destroy()}d=new Element("div",{id:"nm-active-hover","class":"nm-hover",events:{mouseover:function(){d.store("mouseover",!0)},mouseout:function(){d.eliminate("mouseover"),function(){d.retrieve("keep")?d.eliminate("keep"):d.destroy()}.delay(10)},click:function(){c._clickHandler(a)}}}).store("id",a.target.instance.attr("id")),d.setStyles({top:-1e3,left:-1e3}),document.id(document.body).grab(d),b(a,c,d);var e=d.getSize(),f=a.target.getBoundingClientRect();d.setStyles({top:(f.top+f.bottom)/2-e.y/2,left:(f.left+f.right)/2-e.x/2})},networkMap.events.mouseout=function(a){a.target.instance.link,function(){var b=document.id("nm-active-hover");b&&b.retrieve("id")!==a.target.instance.attr("id")||b&&!b.retrieve("mouseover")&&b.destroy()}.delay(10)}):networkMap.events[a]=b},networkMap.registerEvent("click",networkMap.events.click),networkMap.registerEvent("mouseover",networkMap.events.mouseover),networkMap.registerEvent("mouseout",networkMap.events.mouseout),networkMap.registerEvent("hover",networkMap.events.hover),networkMap.colormap=networkMap.colormap||{},networkMap.registerColormap=function(a,b){networkMap.colormap[a]=b},networkMap.colormap.rasta5={translate:function(a){return a?.2>a?networkMap.colormap.rasta5.map[0]:.4>a?networkMap.colormap.rasta5.map[1]:.6>a?networkMap.colormap.rasta5.map[2]:.8>a?networkMap.colormap.rasta5.map[3]:networkMap.colormap.rasta5.map[4]:networkMap.colormap.rasta5.nodata},map:["#3DDE1E","#9BEC1A","#F9EB18","#F98020","#F51329"],limits:[.2,.4,.6,.8,1],nodata:"#C0C0C0"},networkMap.colormap.flat5={translate:function(a){var b=networkMap.colormap.flat5;return a||0===a?0===a?b.map[0]:.2>a?b.map[1]:.4>a?b.map[2]:.6>a?b.map[3]:.8>a?b.map[4]:b.map[5]:b.nodata},map:["#000000","#27ae60","#2ecc71","#f1c40f","#e67e22","#c0392b"],limits:[0,.2,.4,.6,.8,1],nodata:"#ecf0f1"},networkMap.colormap.hsl15={translate:function(a){var b=networkMap.colormap.hsl15;if(!a&&0!==a)return b.nodata;if(0===a)return"#000";var c=220-10*Math.floor(24*a);return 0>c&&(c=360-c),"hsl("+c+", 100%, 50%)"},map:["#000","#007fff","#0af","#00d4ff","#0ff","#0fa","#00ff80","#0f5","#00ff2b","#0f0","#5f0","#80ff00","#af0","#d4ff00","#ff0","#fa0","#ff8000","#f50","#ff2b00","#f00","#f05"],limits:[0,.05,.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1],nodata:"#ecf0f1"},networkMap.ColorLegend=function(a,b){if(this.options={boxSize:25,margin:10,target:null},this.graph=b.graph,delete b.graph,this.setOptions(b),this.colormap=networkMap.colormap[a],!this.colormap)throw'Colormap "'+a+'" is not registerd';this.draw(),setTimeout(function(){var a=this.svg.bbox();return 0===a.x&&0===a.y?this:(this._move(),void 0)}.bind(this),0)},networkMap.extend(networkMap.ColorLegend,networkMap.Options),networkMap.extend(networkMap.ColorLegend,{graph:null,draw:function(){var a=this.colormap.map,b=this.container=this.wrapper=document.createElement("div");this.wrapper.classList.add("nm-colormap"),this.options.target.appendChild(b);var c=this.svg=this.svg||SVG(b).group();return this.svg.clear(),a.forEach(function(b,d){c.rect(this.options.boxSize,this.options.boxSize).attr({fill:b,"stroke-width":1}).move(0,(a.length-1-d)*this.options.boxSize),c.line(-5,(a.length-1-d)*this.options.boxSize,0,(a.length-1-d)*this.options.boxSize).attr({stroke:"#000"}),c.text(Math.round(100*this.colormap.limits[d].toString())+"%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-1.3-d)*this.options.boxSize,"end")}.bind(this)),c.line(-5,a.length*this.options.boxSize,0,a.length*this.options.boxSize).attr({stroke:"#000"}),c.text("0%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-.3)*this.options.boxSize,"end"),this._move(),this},_move:function(){var a=this.svg.bbox();return this.container.style.width=Math.ceil(a.width)+"px",this.container.style.height=Math.ceil(a.height)+"px",this.svg.move(Math.abs(a.x),Math.abs(a.y)),this}}),networkMap.SettingsManager=function(a,b){this.container=a,this.mediator=b,this.editing=!1,this.nav=this.createMenu(),a.appendChild(this.nav),this.mediator&&this.mediator.subscribe("edit",this.edit.bind(this))},networkMap.extend(networkMap.SettingsManager,networkMap.Observable),networkMap.extend(networkMap.SettingsManager,{createMenu:function(){var a=document.createElement("nav");a.classList.add("nm-menu");var b=document.createElement("div");b.classList.add("nm-trigger"),b.innerHTML='<span class="nm-icon nm-icon-menu"></span><a class="nm-label">Settings</a>',b.addEventListener("click",this.toggle.bind(this));var c=this.menu=document.createElement("ul"),d=document.createElement("ul");d.classList.add("nm-object-properties"),d.setAttribute("id","nm-edit-content"),c.appendChild(d);var e=this.menuButtons=document.createElement("li");e.classList.add("clearfix","nm-menu-buttons");var f=this.btnSave=document.createElement("button");return f.textContent="Save",f.classList.add("btn","btn-primary","pull-right"),f.addEventListener("click",this.save.bind(this)),c.appendChild(e),e.appendChild(f),a.appendChild(b),a.appendChild(c),a},getContentContainer:function(){return this.nav.querySelector("#nm-edit-content")},edit:function(a){this.editing=a;var b=this.getContentContainer();return this.clear(),this.displayButtons(),a.toElement?b.appendChild(a.toElement()):b.appendChild(a.getSettingsWidget().toElement()),this.fireEvent("edit",[a]),this},clear:function(){for(var a=this.getContentContainer();a.firstChild;)a.removeChild(a.firstChild);return this},hideButtons:function(a){return this.menuButtons.setStyle("display","none"),this.showButtonsCallback=a?a:function(){},this},displayButtons:function(){return this.showButtonsCallback?(this.showButtonsCallback(),delete this.showButtonsCallback,this.menuButtons.style.display="block",this):this},defaultView:function(){this.clear(),this.fireEvent("defaultView",[this])},toggle:function(){return this.nav.classList.contains("nm-menu-open")?this.disable():this.enable()},enable:function(){return this.nav.classList.add("nm-menu-open"),this.fireEvent("active"),this.fireEvent("defaultView",[this]),this},disable:function(){this.nav.classList.remove("nm-menu-open");for(var a=this.nav.querySelector("#nm-edit-content");a.firstChild;)a.removeChild(a.firstChild);return this.fireEvent("deactive"),this},save:function(){return this.fireEvent("save"),this}}),networkMap.Graph=function(a,b){this.options={width:10,height:10,datasource:void 0,colormap:void 0,enableEditor:!0,allowDraggableNodes:void 0,refreshInterval:300,batchUpdate:!0,gridEnabled:!0,grid:{x:10,y:10},node:{linkGenerator:null},link:{linkGenerator:null}},this.defaults={},this.exportedOptions=[],this.nodes=[],this.links=[],this.saveData={},this._mode="normal",this.options=networkMap.defaults(b,this.options),this.options.node.linkGenerator=this.options.node.linkGenerator?networkMap.Node.createLinkGenerator(this.options.node.linkGenerator):networkMap.Node._linkGenerator,this.options.link.linkGenerator=this.options.link.linkGenerator?networkMap.Link.createLinkGenerator(this.options.link.linkGenerator):networkMap.Link._linkGenerator,this.defaults.node=new networkMap.Properties({},networkMap.Node.defaults),this.defaults.link=new networkMap.Properties({},networkMap.Link.defaults),this.defaults.link.set("colormap",this.options.colormap),this.defaults.link.set("datasource",this.options.datasource),this.element="string"==typeof a||a instanceof String?document.getElementById(a):a,this.container=document.createElement("div"),this.container.classList.add("nm-container"),this.element.appendChild(this.container),this.svg=SVG(this.container),this.graph=this.svg.group(),this.legend=new networkMap.ColorLegend(this.defaults.link.get("colormap"),{graph:this,target:this.container}),this.options.enableEditor&&(this.settings=new networkMap.SettingsManager(this.container,this),this.settings.addEvent("defaultView",function(){this.settings.edit(this)}.bind(this)),this.settings.addEvent("active",this.enableEditor.bind(this)),this.settings.addEvent("deactive",this.disableEditor.bind(this)),this.settings.addEvent("save",this.save.bind(this))),this.addEvent("resize",this.rescale.bind(this)),this.setRefreshInterval(this.options.refreshInterval),this.svg.on("click",this._clickHandler.bind(this)),this.addEvent("load",this.update.bind(this))},networkMap.extend(networkMap.Graph,networkMap.Observable),networkMap.extend(networkMap.Graph,networkMap.Mediator),networkMap.extend(networkMap.Graph,networkMap.Options),networkMap.extend(networkMap.Graph,{setDefaults:function(a,b){if(!this.defaults[a])throw"Illigal element";return this.defaults[a].load(b),this.fireEvent("redraw",[{defaultsUpdated:!0}]),this},getDefaults:function(a){if(!this.defaults[a])throw"Illigal element";return this.defaults[a]},setRefreshInterval:function(a){return this.options.interval=a,a?this.intervalId=setInterval(function(){this.update()}.bind(this),1e3*a):this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId),this},triggerEvent:function(a,b){return b.fireEvent(a,b),this},rescale:function(){var a={x:this.element.offsetWidth,y:this.element.offsetHeight};this.svg.size(a.x,a.y);var b=this.graph.bbox();return a.x<b.width+Math.abs(b.x)||a.y<b.height+Math.abs(b.y)?this.svg.viewbox(b.x,b.y,b.width+Math.abs(b.x),b.height+Math.abs(b.y)):this.svg.viewbox(b.x<0?b.x:0,b.y<0?b.y:0,a.x,a.y),this},getSVG:function(){return this.svg},getPaintArea:function(){return this.graph},settingsManager:function(){return this.settings()},getSettingsWidget:function(){var a,b=new networkMap.widget.Accordion,c=function(a,b){return function(c,d){a.set(b,d.value())}.bind(this)}.bind(this);return a=b.add("Globals"),a.appendChild(new networkMap.widget.GridInput("Grid",{enabled:this.options.gridEnabled,grid:this.options.grid}).addEvent("change",function(a){a.value.enabled?this.grid(a.value.grid):this.grid(!1)}.bind(this))),a=b.add("Node Defaults"),networkMap.each(networkMap.Node.defaultTemplate,function(b,d){"number"===b.type?a.appendChild(new networkMap.widget.IntegerInput(b.label,this.defaults.node.get(d,!0),b).addEvent("change",c(this.defaults.node,d))):"text"===b.type?a.appendChild(new networkMap.widget.TextInput(b.label,this.defaults.node.get(d,!0),b).addEvent("change",c(this.defaults.node,d))):"color"===b.type&&a.appendChild(new networkMap.widget.ColorInput(b.label,this.defaults.node.get(d,!0),b).addEvent("change",c(this.defaults.node,d)))}.bind(this)),a=b.add("Link Defaults"),networkMap.each(networkMap.Link.defaultTemplate,function(b,d){"number"===b.type?a.appendChild(new networkMap.widget.IntegerInput(b.label,this.defaults.link.get(d,!0),b).addEvent("change",c(this.defaults.link,d))):"text"===b.type?a.appendChild(new networkMap.widget.TextInput(b.label,this.defaults.link.get(d,!0),b).addEvent("change",c(this.defaults.link,d))):"color"===b.type&&a.appendChild(new networkMap.widget.ColorInput(b.label,this.defaults.link.get(d,!0),b).addEvent("change",c(this.defaults.link,d)))}.bind(this)),b},grid:function(a){return a===!0?(this.options.gridEnabled=!0,this):(a===!1&&(this.options.gridEnabled=!1),void 0===a?this.options.gridEnabled?this.options.grid:!1:("object"==typeof a&&(this.options.gridEnabled=!0,this.options.grid=a),this.disableDraggableNodes(),this.enableDraggableNodes(),this))},load:function(a){if("string"==typeof a||a instanceof String)return this.loadUrl(a);if(null!==a&&"object"==typeof a)return this.loadObject(a);throw new TypeError("Unknown type "+Object.prototype.toString.call(a))},loadUrl:function(a){var b=new XMLHttpRequest;return b.open("GET",a,!0),b.onload=function(){b.status>=200&&b.status<400?this.loadObject(JSON.parse(b.responseText)):(new networkMap.widget.Modal).alert("There was an error when loading the weathermap ("+b.status+")",{title:"Error"})}.bind(this),b.onerror=function(){(new networkMap.widget.Modal).alert("An error occurred when trying to load the resource",{title:"Error"})
},b.send(),this},loadObject:function(a){return this.setOnSave(a.onSave),a.defaults&&(this.setDefaults("node",a.defaults.node||{}),this.setDefaults("link",a.defaults.link||{})),a.nodes.forEach(function(a){a.graph=this,a.draggable=this.options.allowDraggableNodes,this.addNode(new networkMap.Node(a),!1)}.bind(this)),a.links.forEach(function(a){a.graph=this,this.addLink(new networkMap.Link(a),!1)}.bind(this)),this.fireEvent("load",[this]),this.triggerEvent("resize",this),this},setOnSave:function(a){return a&&this.validateSave(a)&&(this.saveData=a),this},getOnSave:function(){return this.saveData?this.saveData:{}},validateSave:function(a){return a.method&&"post"!=a.method&&"get"!=a.method?(this.saveEnabled=!1,alert("Illigal argument: "+a.method+". Valid onSave.method arguments are: post, get"),!1):(a.method="post",a.data=a.data||{},a.url?!0:(this.saveEnabled=!1,alert("Missing argument onSave.url"),!1))},save:function(){if(!this.saveData)return!1;var a=this.getConfiguration(),b=this.settings.btnSave.innerHTML;this.settings.btnSave.textContent=".....";var c=networkMap.toQueryString(a),d=new XMLHttpRequest;return d.open(this.saveData.method,this.saveData.url,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onload=function(){this.settings.btnSave.innerHTML=b,d.status>=200&&d.status<400?(a=JSON.parse(d.responseText),"ok"===a.status&&(new networkMap.widget.Modal).alert("Weathermap saved"),"nok"===a.status&&(new networkMap.widget.Modal).alert(a.error,{title:"Error"}),"deleted"==a.status&&(new networkMap.widget.Modal).alert("The networkmap is deleted",{title:"Error"})):(new networkMap.widget.Modal).alert("There was an error while saving the weathermap ("+d.status+")",{title:"Error"})}.bind(this),d.onerror=function(){this.settings.btnSave.innerHTML=b,(new networkMap.widget.Modal).alert("There was an error while saving the weathermap",{title:"Error"})},d.send(c),!0},enableEditor:function(){return this.enableDraggableNodes(),this.nodes.forEach(function(a){a.mode("edit")}),this.links.forEach(function(a){a.mode("edit")}),this._mode="edit",this},disableEditor:function(){return this.disableDraggableNodes(),this.nodes.forEach(function(a){a.mode("normal")}),this.links.forEach(function(a){a.mode("normal")}),this._mode="normal",this},_clickHandler:function(a){"edit"===this._mode&&(a.target.instance===this.svg||a.target.instance===this.graph)&&this.settings.edit(this)},enableDraggableNodes:function(){return this.nodes.forEach(function(a){a.draggable()}),this},disableDraggableNodes:function(){return this.nodes.forEach(function(a){a.fixed()}),this},getConfiguration:function(){var a={defaults:{node:this.defaults.node.extract(),link:this.defaults.link.extract()},nodes:[],links:[],onSave:this.saveData};return this.exportedOptions.forEach(function(b){a[b]=this.options[b]}.bind(this)),a.onSave=this.saveData,this.nodes.forEach(function(b){a.nodes.push(b.getConfiguration())}),this.links.forEach(function(b){a.links.push(b.getConfiguration())}),a},registerLinkGenerator:function(a,b){this._linkGenerator[a]=b},addNode:function(a,b){return this.nodes.push(a),a.addEvent("requestHref",this.options.node.linkGenerator),a.updateLink(),b!==!1&&this.triggerEvent("resize",this),this},getNode:function(a){return networkMap.find(this.nodes,function(b){return b.options.id===a?!0:void 0})},removeNode:function(a){return this.nodes.erase(a),a.setGraph(null),this.getLinks(a).forEach(function(a){this.removeLink(a)}.bind(this)),this},addLink:function(a,b){return this.links.push(a),a.addEvent("requestHref",this.options.link.linkGenerator),a.updateLink(),b!==!1&&this.triggerEvent("resize",this),this},getLink:function(a,b){return networkMap.find(this.links,function(c){return c.nodeA.options.id===a&&c.nodeB.options.id===b?!0:c.nodeA.options.id===b&&c.nodeB.options.id===a?!0:void 0})},getLinks:function(a,b){var c=[];return this.links.forEach(function(d){d.connectedTo(a,b)&&c.push(d)}),c},removeLink:function(a){return this.links.erase(a),a.setGraph(null),this},refresh:function(){return console.log("refresh is depricated, use update instead"),this.update()},registerUpdateEvent:function(a,b,c,d){this.$updateQ=this.$updateQ||{},this.$updateQ[a]=this.$updateQ[a]||{},this.$updateQ[a][b]=this.$updateQ[a][b]||[],this.$updateQ[a][b].push({link:c,callback:d})},update:function(){return this.options.batchUpdate?this.batchUpdate():(this.links.forEach(function(a){a.localUpdate()}),this)},batchUpdate:function(){return networkMap.each(this.$updateQ,function(a,b){if(!networkMap.datasource[b])throw"Unknown datasource ("+b+")";networkMap.each(a,function(a,c){networkMap.datasource[b](c,a)}.bind(this))}.bind(this)),this}}),networkMap.Node=function(a){if(this.graph=a.graph,delete a.graph,this.properties=new networkMap.Properties(a,networkMap.Node.defaults),this.configurationWidget=new networkMap.Node.Module.Settings,this.properties.addEvent("change",function(a){this.options=this.properties.configuration(),a.length>=1&&("x"===a[0].key||"y"===a[0].key)||this.draw()}.bind(this)),this.options=this.properties.configuration(),!this.options.id)throw"Node(create, no id given)";this.options.x=parseFloat(this.options.x),this.options.y=parseFloat(this.options.y),this.options.padding=parseFloat(this.options.padding),this.setGraph(this.graph)},networkMap.extend(networkMap.Node,networkMap.Options),networkMap.extend(networkMap.Node,networkMap.Observable),networkMap.extend(networkMap.Node,{_mode:"normal",exportedOptions:["id","name","comment","x","y","lat","lng","weight","renderer","information","label","padding","href","style","events","fontFamily","fontSize","bgColor","strokeColor","strokeWidth"],setProperty:function(a,b){if(!this.editTemplate[a])throw"Unknow id: "+a;return this.properties.set(a,b),this.options=this.properties.configuration(),this},getProperty:function(a){return this.properties.get(a,!0).value},getConfiguration:function(){return this.properties.extract()},enableEvent:function(a,b){if("hover"!==a&&"click"!==a)throw"Unknown event";this.options.events=this.options.events||{},this._localConfig.events=this._localConfig.events||{};var c={enabled:!0};return this.options.events[a]=b||c,this._localConfig.events[a]=b||c,this},disableEvent:function(a){return this.options.events&&this.options.events[a]&&(delete this.options.events[a],delete this._localConfig.events[a]),this},setGraph:function(a){return this.graph&&(this.graph.removeEvent("redraw",this._redraw.bind(this)),this.graph=null,this.draw()),a&&(this.graph=a,this.properties.setDefaults(a.getDefaults("node")),this.graph.addEvent("redraw",this._redraw.bind(this)),this.draw()),this},_redraw:function(){this.draw()},mode:function(a){if(!a)return this._mode;if("edit"!==a&&"normal"!==a)throw"Unknown mode: "+a;return this._mode=a,this},_clickhandler:function(a){a.target.instance.data("dragged")||("normal"===this._mode&&this.options.events&&this.options.events.click?networkMap.events.click(a,this):"edit"===this._mode&&(a.preventDefault(),this.graph.publish("edit",[this.configurationWidget.toElement(this.properties)])))},x:function(){return this.svg.bbox().x},y:function(){return this.svg.bbox().y},draggable:function(){return this._draggable=!0,this.svg.draggable({grid:this.graph.grid()}),this.svg.remember("cursor",this.svg.style("cursor")),this.svg.style("cursor","move"),this},fixed:function(){this._draggable=!1,this.svg.fixed();var a=this.svg.remember("cursor");return this.svg.forget("cursor"),this.svg.style("cursor",a||"default"),this},isDraggable:function(){return this._draggable},updateLink:function(){var a=this.options.href;return a?(networkMap.isFunction(a)?this.setLink(a(this)):this.setLink(a),this):(this.fireEvent("requestHref",[this]),this)},setLink:function(a){return a?this.link?(this.link.to(a),this):(this.link=this.svg.linkTo(a),this):this},bbox:function(){return this.svg.bbox()},draw:function(){var a=!1;if(this.svg){if(this.svg.remove(),this.link&&link.remove(),!this.graph)return!1;a=!0}if(!this.graph)return!1;this.debug&&this.debug.remove(),this.options.debug&&(this.debug=this.graph.getPaintArea().group());var b=this.svg=this.graph.getPaintArea().group();this.updateLink();var c,d=b.text(this.options.name).font({family:this.options.fontFamily,size:this.options.fontSize,anchor:"start",leading:this.options.fontSize-1}).move(parseFloat(this.options.padding),parseFloat(this.options.padding)),e=d.bbox();for(this.options.comment&&""!==this.options.comment&&(d.text(function(a){a.tspan(this.options.name).newLine(),c=a.tspan(this.options.comment).newLine().attr("font-size",this.options.fontSize-2)}.bind(this)),c.attr("text-anchor","middle"),c.dx(e.width/2));e.width<d.bbox().width;)c.attr("font-size",c.attr("font-size")-1);e=d.bbox();var f=b.rect(1,1).fill({color:this.options.bgColor}).stroke({color:this.options.strokeColor,width:this.options.strokeWidth}).attr({rx:4,ry:4}).size(e.width+2*this.options.padding,e.height+2*this.options.padding);return d.front(),b.on("click",this._clickhandler.bind(this)),this.options.events&&(b.link=this.options.events,this.options.events.click&&b.attr("cursor","pointer")),f.clone().fill({opacity:0}).front(),b.move(parseFloat(this.options.x),parseFloat(this.options.y)),this.options.draggable&&this.draggable(),b.dragstart=function(){this.fireEvent("dragstart")}.bind(this),b.dragmove=function(a,b){this.fireEvent("drag",[a,b])}.bind(this),b.dragend=function(){console.log("dragend"),this.properties.set({x:this.x(),y:this.y()}),this.fireEvent("dragend")}.bind(this),this.isDraggable()&&this.draggable(),this.fireEvent("dragend"),!0}}),networkMap.Node.defaultTemplate={padding:{label:"Padding",type:"number",min:0},fontSize:{label:"Font size",type:"number",min:1},bgColor:{label:"Color",type:"color"},strokeColor:{label:"Stroke color",type:"color"},strokeWidth:{label:"Stroke width",type:"number",min:0}},networkMap.Node.registerLinkGenerator=function(a){networkMap.Node._linkGenerator=networkMap.Node.createLinkGenerator(a)},networkMap.Node.createLinkGenerator=function(a){return function(b){var c=b.properties.get("href");return c?(networkMap.isFunction(c)?b.setLink(c()):b.setLink(c),void 0):(b.setLink(a(b)),void 0)}},networkMap.Node.registerLinkGenerator(function(){return null}),networkMap.Node.defaults=new networkMap.Properties({name:null,comment:null,x:10,y:10,lat:null,lng:null,weight:null,fontFamily:"Helvetica",fontSize:16,bgColor:"#dddddd",strokeColor:"#000000",strokeWidth:2,information:{},data:{value:null,realValue:null},label:{position:"internal",visable:!0},renderer:"rect",padding:10,href:null,style:null,debug:!1,draggable:!1}),networkMap.Node.Module=networkMap.Node.Module||{},networkMap.Node.Module.Settings=function(a){this.properties=a},networkMap.extend(networkMap.Node.Module.Settings,{parameters:{id:{label:"ID",type:"text",disabled:!0,global:!1},name:{label:"Name",type:"text",global:!1},comment:{label:"Comment",type:"text",global:!1},padding:{label:"Padding",type:"number",min:0,global:!0},fontSize:{label:"Font size",type:"number",min:1,global:!0},bgColor:{label:"Color",type:"color",global:!0},strokeColor:{label:"Stroke color",type:"color",global:!0},strokeWidth:{label:"Stroke width",type:"number",min:0,global:!0}},toElement:function(a){var b,c=new networkMap.widget.Accordion,d=function(a,b){return function(c,d){b.set(a,d.value())}};return b=c.add("Globals"),networkMap.each(this.parameters,function(c,e){"number"===c.type?b.appendChild(new networkMap.widget.IntegerInput(c.label,a.get(e),c).addEvent("change",d(e,a))):"text"===c.type?b.appendChild(new networkMap.widget.TextInput(c.label,a.get(e),c).addEvent("change",d(e,a))):"color"===c.type&&b.appendChild(new networkMap.widget.ColorInput(c.label,a.get(e),c).addEvent("change",d(e,a)))}.bind(this)),c}}),networkMap.LinkPath=function(a,b,c){this.properties=new networkMap.Properties(c,a.properties),this.properties.addEvent("change",function(a){this.fireEvent("change",a)}.bind(this)),this.link=a,this.svg=b,this.properties.get("requestUrl")&&this.link.registerUpdateEvent(this.properties.get("datasource"),this.properties.get("requestUrl"),this,function(a){this.link.updateBgColor(this,this.link.colormap.translate(a.value))}.bind(this)),this.setupEvents()},networkMap.extend(networkMap.LinkPath,networkMap.Options),networkMap.extend(networkMap.LinkPath,networkMap.Observable),networkMap.extend(networkMap.LinkPath,{remove:function(){this.svg.remove()},getEditables:function(){var a={width:{label:"Local width",type:"int"}};return a},updateLink:function(){var a=this.properties.get("href");return a?(networkMap.isFunction(a)?this.setLink(a(this)):this.setLink(a),this):(this.fireEvent("requestHref",[this]),this)},setLink:function(a){return a?this.a?(this.a.to(a),this):(this.svg.parent&&(this.a=this.svg.linkTo(a)),this):this},getLink:function(){return this.link},getNode:function(){return this.getLink().getNode(this)},getSettingsWidget:function(){return this.getLink().getSettingsWidget()},getProperty:function(a){return this.properties.get(a)},setProperty:function(a,b){if("width"==a){var c=this.getMainPath();if(c!=this)return c.setProperty(a,b)}return this.properties.set(a,b),this.fireEvent("change",[a]),this},getConfiguration:function(){return this.properties.extract()},getMainPath:function(){var a;return this.link.subpath.nodeA&&(this.link.subpath.nodeA.forEach(function(b){this==b&&(a=this.link.path.nodeA)}.bind(this)),a)?a:this.link.subpath.nodeB&&(this.link.subpath.nodeB.forEach(function(b){this==b&&(a=this.link.path.nodeB)}.bind(this)),a)?a:this},setupEvents:function(){this.svg.on("click",this._clickHandler.bind(this)),this.properties.get("events")&&(this.properties.get("events.click")&&this.svg.attr("cursor","pointer"),this.properties.get("events.hover")&&(this.svg.on("mouseover",this._hoverHandler.bind(this)),this.svg.on("mouseout",this._hoverHandler.bind(this))))},_clickHandler:function(a){"normal"===this.link.mode()&&this.properties.get("events.click")?networkMap.events.click(a,this):"edit"===this.link.mode()&&(a.preventDefault(),this.link.graph.publish("edit",[this.link.configurationWidget.toElement(this.link,this.link.properties)]))},_hoverHandler:function(a){"edit"!==this.link.mode()&&("mouseover"===a.type&&networkMap.events.mouseover(a,this),"mouseout"===a.type&&networkMap.events.mouseout(a,this))}}),networkMap.Link=function(a){this.$debug=0,this.pathPoints=[],this.svgEl={},this.updateQ={},this._mode="normal",this.path={},this.subpath={},this.graph=a.graph,delete a.graph,this.properties=new networkMap.Properties(a,networkMap.Link.defaults),this.properties.addEvent("change",function(){this.options=this.properties.configuration(),this.draw()}.bind(this)),this.options=this.properties.configuration(),this.configurationWidget=new networkMap.Link.Module.Settings,this.colormap=networkMap.colormap[this.properties.get("colormap")],this.datasource=networkMap.datasource[this.properties.get("datasource")],this.setGraph(this.graph)},networkMap.extend(networkMap.Link,networkMap.Options),networkMap.extend(networkMap.Link,networkMap.Observable),networkMap.extend(networkMap.Link,{exportedOptions:["inset","connectionDistance","staticConnectionDistance","arrowHeadLength","width","background"],editTemplate:{width:{label:"Width",type:"number",min:0},inset:{label:"Inset",type:"number",min:1},connectionDistance:{label:"Chamfer",type:"number",min:0},staticConnectionDistance:{label:"Offset",type:"number",min:1},arrowHeadLength:{label:"Arrow Head",type:"number",min:0}},getEditables:function(){return this.editTemplate},setProperty:function(a,b){if(!this.editTemplate[a])throw"Unknow id: "+a;this.options[a]=b,this._localConfig[a]=b,this.redraw()},getProperty:function(a){if(!this.editTemplate[a])throw"Unknow id: "+a;return this.properties.get(a)},updateLink:function(){return this.subpath.nodeA&&this.subpath.nodeA.forEach(function(a){a.updateLink()}),this.subpath.nodeB&&this.subpath.nodeB.forEach(function(a){a.updateLink()}),this.path.nodeA&&this.path.nodeA.updateLink(),this.path.nodeB&&this.path.nodeB.updateLink(),this},getNode:function(a){var b=function(b){return b===a?!0:void 0};if(this.path.nodeA===a)return this.nodeA;if(this.subpath.nodeA&&this.subpath.nodeA.some(b,this))return this.nodeA;if(this.path.nodeB===a)return this.nodeB;if(this.subpath.nodeB&&this.subpath.nodeB.some(b,this))return this.nodeB;throw"Link is not found"},connectedTo:function(a,b){return b?!(this.nodeA!=a&&this.nodeB!=a||this.nodeA!=b&&this.nodeB!=b):this.nodeA==a||this.nodeB==a},mode:function(a){if(!a)return this._mode;if("edit"!==a&&"normal"!==a)throw"Unknown mode: "+a;return this._mode=a,this},getConfiguration:function(){var a=this.properties.extract();return this.path.nodeA&&(a.nodeA=this.path.nodeA.getConfiguration()),this.subpath.nodeA&&(a.nodeA=a.nodeA||{},a.nodeA.sublinks=[],this.subpath.nodeA.forEach(function(b){a.nodeA.sublinks.push(b.getConfiguration())})),this.path.nodeB&&(a.nodeB=this.path.nodeB.getConfiguration()),this.subpath.nodeB&&(a.nodeB=a.nodeB||{},a.nodeB.sublinks=[],this.subpath.nodeB.forEach(function(b){a.nodeB.sublinks.push(b.getConfiguration())})),a},setGraph:function(a){null===a&&(this.graph=null,this.draw()),a&&(this.graph=a,this.properties.setDefaults(this.graph.getDefaults("link")),this.options.datasource=this.options.datasource||this.graph.options.datasource,this.graph.addEvent("redraw",function(){this.draw()}.bind(this)),this._setupSVG(this.properties.configuration()),this.draw())},_setupSVG:function(a){if(this.svg=this.graph.getPaintArea().group(),!a.nodeA||!a.nodeB)throw"Link(create, missing node in link definition)";if(this.nodeA=this.graph.getNode(a.nodeA.id),!this.nodeA)throw"Link(create, nodeA does not exist ("+this.options.nodeA.id+")";if(link=a.nodeA,link.sublinks&&(sublinks=link.sublinks,delete link.sublinks,this.subpath.nodeA=[],sublinks.forEach(function(a){this.subpath.nodeA.push(new networkMap.LinkPath(this,networkMap.path(this.svg),a).addEvent("change",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)))}.bind(this))),this.path.nodeA=new networkMap.LinkPath(this,networkMap.path(this.svg),link).addEvent("change",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)),(this.options.nodeA.requestData||this.options.nodeA.sublinks)&&(this.svgEl.nodeA={},this.options.nodeA.sublinks&&(this.svgEl.nodeA.sublinks=[])),this.nodeB=this.graph.getNode(a.nodeB.id),!this.nodeB)throw"Link(create, nodeB does not exist ("+this.options.nodeB.id+")";link=a.nodeB,link.sublinks&&(sublinks=link.sublinks,delete link.sublinks,this.subpath.nodeB=[],sublinks.forEach(function(a){this.subpath.nodeB.push(new networkMap.LinkPath(this,networkMap.path(this.svg),a).addEvent("change",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)))}.bind(this))),this.path.nodeB=new networkMap.LinkPath(this,networkMap.path(this.svg),link).addEvent("change",this.redraw.bind(this)).addEvent("requestHref",function(a){this.fireEvent("requestHref",[a])}.bind(this)),(this.options.nodeB.requestData||this.options.nodeB.sublinks)&&(this.svgEl.nodeB={},this.options.nodeB.sublinks&&(this.svgEl.nodeB.sublinks=[]))},_cleanDebugLayer:function(){this.debug&&this.debug.clear(),this.options.debug&&!this.debug&&(this.debug=this.graph.getPaintArea().group())},redraw:function(){return this.redrawShadowPath(),this.drawMainPath(),this.drawSublinks(),this},draw:function(){if(this.svg&&!this.graph)return this.svg.remove(),!1;if(!this.graph)return!1;this._cleanDebugLayer();var a=this.svg;a.back(),this.nodeA.bbox(),this.nodeB.bbox(),this.shadowPath=a.path().attr({fill:"none",stroke:"#000","stroke-dasharray":"3,5","stroke-width":2}),this.redrawShadowPath().hideShadowPath(),this.drawMainPath(),this.drawSublinks(),this.update(),this.nodeA.addEvent("drag",function(){this._cleanDebugLayer(),this.redrawShadowPath()}.bind(this)),this.nodeB.addEvent("drag",function(){this._cleanDebugLayer(),this.redrawShadowPath()}.bind(this)),this.nodeA.addEvent("dragstart",function(){this.shadowPath.show(),this.hidePaths()}.bind(this)),this.nodeB.addEvent("dragstart",function(){this.shadowPath.show(),this.hidePaths()}.bind(this)),this.nodeA.addEvent("dragend",function(){this.redrawShadowPath().hideShadowPath(),this.drawMainPath(),this.drawSublinks(),this.showPaths()}.bind(this)),this.nodeB.addEvent("dragend",function(){this.redrawShadowPath().hideShadowPath(),this.drawMainPath(),this.drawSublinks(),this.showPaths()}.bind(this))},vec2add:function(a,b,c){return c=c||[0,0],c[0]=a[0]+b[0],c[1]=a[1]+b[1],c},vec2sub:function(a,b,c){return c=c||[0,0],c[0]=a[0]-b[0],c[1]=a[1]-b[1],c},vec2distance:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},vec2len:function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},vec2normalize:function(a,b){b=b||[0,0];var c=a[0],d=a[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),b[0]=a[0]*e,b[1]=a[1]*e),b},vec2maxDir:function(a,b){b=b||[0,0];var c=Math.abs(a[0]),d=Math.abs(a[1]);return c>d?(b[0]=a[0]/c,b[1]=0):(b[0]=0,b[1]=a[1]/d),b},vec2scale:function(a,b,c){return c=c||[0,0],c[0]=a[0]*b,c[1]=a[1]*b,c},vec2mul:function(a,b,c){return c=c||[0,0],c[0]=a[0]*b[0],c[1]=a[1]*b[1],c},vec2confine:function(a,b,c){return c=c||[0,0],c[0]=Math.abs(a[0])<Math.abs(b[0])?a[0]:a[0]/Math.abs(a[0])*b[0],c[1]=Math.abs(a[1])<Math.abs(b[1])?a[1]:a[1]/Math.abs(a[1])*b[1],c},vec2clone:function(a,b){return b=b||[0,0],b[0]=a[0],b[1]=a[1],b},edgePoints:function(){var a=this.nodeA.bbox(),b=this.nodeB.bbox(),c=[a.width/2,a.height/2],d=[b.width/2,b.height/2],e=[],f=this.properties.get("inset")||1,g=this.properties.get("connectionDistance")||1,h=this.properties.get("staticConnectionDistance")||1,i=[a.cx,a.cy],j=[b.cx,b.cy],k=this.vec2sub(j,i),l=this.vec2maxDir(k),m=[0,0];this.vec2mul(l,c,m),this.vec2sub(m,this.vec2scale(l,f),m);var n=this.vec2clone(m);this.vec2add(i,m,m),e.push(m),e.push(this.vec2add(i,this.vec2add(n,this.vec2scale(l,g)))),this.vec2add(n,this.vec2scale(l,g),n),e.push(this.vec2add(i,this.vec2add(n,this.vec2scale(l,h))));var o=[-1*k[0],-1*k[1]],p=this.vec2maxDir(o),q=[0,0];this.vec2mul(p,d,q),this.vec2sub(q,this.vec2scale(p,f),q);var r=this.vec2clone(q);return this.vec2add(j,q,q),baseBB=[0,0],this.vec2add(r,this.vec2scale(p,g),baseBB),e.push(this.vec2add(j,this.vec2add(baseBB,this.vec2scale(p,h)))),e.push(this.vec2add(j,this.vec2add(r,this.vec2scale(p,g)))),e.push(q),this.$edgePoints={nodeA:{point:new SVG.math.Point(m[0],m[1]),direction:l},nodeB:{point:new SVG.math.Point(q[0],q[1]),direction:p},path:e},this.$edgePoints},drawEdgeHandle:function(a){var b=a.svg=a.svg||this.graph.getPaintArea().group(),c=[0,0];this.vec2scale(a.direction,30,c),this.vec2add([a.point.x,a.point.y],c,c),b.path().M(a.point).L(c[0],c[1]).stroke({fill:"none",color:"#000",dasharray:"3 3",width:1});var d=b.circle(10).center(c[0],c[1]).fill("#fff").stroke({color:"#000"}).draggable({fn:function(b){var c=[b.x,b.y],d=[a.point.x,a.point.y],e=this.vec2add(this.vec2scale(this.vec2normalize(this.vec2sub(c,d)),30),d);return{x:e[0],y:e[1]}}.bind(this)}),e=this.nodeA.bbox(),f=d.clone().addTo(b).center(a.point.x,a.point.y).draggable({minX:e.x,maxX:e.x+e.width,minY:e.y,maxY:e.y+e.height});return f.dragmove=function(b,c){var e=[0,0];this.vec2scale(a.direction,30,e),d.center(c.target.instance.cx()+e[0],c.target.instance.cy()+e[1]),console.log(c.target.instance.cx()+e[0],c.target.instance.cy()+e[1])}.bind(this),b.front(),this},redrawShadowPath:function(){var a=this.edgePoints();return this.pathPoints.length=0,a.path.forEach(function(a){this.pathPoints.push(new SVG.math.Point(a[0],a[1]))}.bind(this)),this.shadowPath.clear().M.apply(this.shadowPath,a.path[0]).L.apply(this.shadowPath,a.path[2]).L.apply(this.shadowPath,a.path[3]).L.apply(this.shadowPath,a.path[5]),this},removeMainPath:function(){this.mainPathA&&this.mainPathA.remove(),this.mainPathB&&this.mainPathB.remove()},hidePaths:function(){return this.path.nodeA&&this.path.nodeA.svg.hide(),this.subpath.nodeA&&this.subpath.nodeA.forEach(function(a){a.svg.hide()}),this.path.nodeB&&this.path.nodeB.svg.hide(),this.subpath.nodeB&&this.subpath.nodeB.forEach(function(a){a.svg.hide()}),this},showPaths:function(){return this.path.nodeA&&this.path.nodeA.svg.show(),this.subpath.nodeA&&this.subpath.nodeA.forEach(function(a){a.svg.show()}),this.path.nodeB&&this.path.nodeB.svg.show(),this.subpath.nodeB&&this.subpath.nodeB.forEach(function(a){a.svg.show()}),this},showShadowPath:function(){return this.shadowPath.show(),this},hideShadowPath:function(){return this.shadowPath.hide(),this},drawMainPath:function(){var a,b=1,c=function(a,c){var d=a.getProperty("width"),e=new SVG.math.Line(c[0],c[2]),f=new SVG.math.Line(c[2],c[3]),g=e.perpendicularLine(c[1],b*d),h=e.perpendicularLine(c[2],b*d),i=f.perpendicularLine(c[2],b*d),j=f.midPoint(),k=f.move(j,f.p1,a.link.options.arrowHeadLength);f.move(j,f.p2,a.link.options.arrowHeadLength);var l=f.perpendicularLine(k,b*d),m=new SVG.math.Line(g.p1,h.p1),n=new SVG.math.Line(i.p1,l.p1),o=n.intersection(m);o.parallel===!0&&(o=g.p1),m=new SVG.math.Line(g.p2,h.p2),n=new SVG.math.Line(i.p2,l.p2);var p=n.intersection(m);p.parallel===!0&&(p=g.p2),a.svg.clear(),a.svg.M(c[0]).L(g.p1).L(o).L(l.p1).L(j).L(l.p2).L(p).L(g.p2).Z().front()},d=function(a,b,c){var d=a.getProperty("width"),e=new SVG.math.Line(b[2],b[3]),f=e.midPoint(),g=e.move(f,e.p1,a.link.options.arrowHeadLength),h=e.perpendicularLine(g,c*d/2),i=new SVG.math.Line(b[2],f).midPoint(),j=e.perpendicularLine(i,c*d/2);a.svg.clear(),a.svg.M(i).L(j.p1).L(h.p1).L(f).L(h.p2).L(j.p2).Z().front()},e=function(){},f=function(){};return this.options.nodeA.requestUrl?(a=[this.pathPoints[0],this.pathPoints[1],this.pathPoints[2],this.pathPoints[3]],this.subpath.nodeA?this.options.nodeB.requestUrl||this.subpath.nodeB?d(this.path.nodeA,a,this.subpath.nodeA.length):f():this.options.nodeB.requestUrl||this.subpath.nodeB?c(this.path.nodeA,a):e()):this.path.nodeA.remove(),this.options.nodeB.requestUrl?(a=[this.pathPoints[5],this.pathPoints[4],this.pathPoints[3],this.pathPoints[2]],this.subpath.nodeB?this.options.nodeA.requestUrl||this.subpath.nodeA?d(this.path.nodeB,a,this.subpath.nodeB.length):f():this.options.nodeA.requestUrl||this.subpath.nodeA?c(this.path.nodeB,a):e()):this.path.nodeB.remove(),this},drawArc:function(){},drawSublinks:function(){var a,b,c,d,e,f=function(d,f,g,h){for(var i=0;c>=-a/2;){var j={width:+e,linkCount:a},k=this.calculateSublinkPath(g,c*h,j);b&&(d[i].svg.clear(),c===-.5?d[i].svg.M(f).L(b[0]).L(b[1]).L(b[2]).L(g[g.length-1]).L(k[2]).L(k[1]).L(k[0]).Z().back():d[i].svg.M(f).L(b[0]).L(b[1]).L(b[2]).L(k[2]).L(k[1]).L(k[0]).Z().back(),i+=1),b=k,c-=1}}.bind(this);return this.subpath.nodeA&&(a=this.subpath.nodeA.length,b=null,c=a/2,d=[this.pathPoints[0],this.pathPoints[1],this.pathPoints[2],new SVG.math.Line(this.pathPoints[2],this.pathPoints[3]).midPoint()],e=this.path.nodeA.getProperty("width")||this.options.width,f(this.subpath.nodeA,this.pathPoints[0],d,1)),this.subpath.nodeB&&(a=this.subpath.nodeB.length,b=null,c=a/2,d=[this.pathPoints[5],this.pathPoints[4],this.pathPoints[3],new SVG.math.Line(this.pathPoints[3],this.pathPoints[2]).midPoint()],e=this.path.nodeB.getProperty("width")||this.options.width,f(this.subpath.nodeB,this.pathPoints[5],d,-1)),this},calculateSublinkPath:function(a,b,c){var d=c.width||this.options.width,e=d*b,f=Math.atan2(this.options.arrowHeadLength,Math.abs(d*c.linkCount/2)),g=Math.abs(e*Math.tan(f)),h=new SVG.math.Line(a[0],a[2]),i=new SVG.math.Line(a[2],a[3]),j=h.perpendicularLine(a[1],e),k=h.perpendicularLine(a[2],e),l=i.perpendicularLine(a[2],e),m=i.move(i.p2,i.p1,g),n=i.perpendicularLine(m,e),o=new SVG.math.Line(j.p1,k.p1),p=new SVG.math.Line(l.p1,n.p1),q=p.intersection(o);return q.parallel===!0&&(q=j.p1),[j.round(2).p1,q.round(2),n.round(2).p1]},setInterval:function(){console.log("Seting link update interval"),this.intervalId=setInterval(function(){this.update()}.bind(this),this.options.refreshInterval)},clearInterval:function(){return console.log("removing link update interval"),this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId),this},registerUpdateEvent:function(a,b,c,d){this.updateQ[a]=this.updateQ[a]||{},this.updateQ[a][b]=this.updateQ[a][b]||[],this.updateQ[a][b].push({link:c,callback:d}),this.graph.registerUpdateEvent(a,b,c,d)},localUpdate:function(){return console.log("localUpdate is depricated, please use update instead"),this.graph.options.batchUpdate?void 0:this.update()},update:function(a){return this.properties.get("globalRefresh")||a!==!0?this:(this.graph.options.batchUpdate||networkMap.each(this.updateQ,function(a,b){if(!networkMap.datasource[b])throw"Unknown datasource ("+b+")";networkMap.each(a,function(a,c){this.options.batchUpdate?networkMap.datasource[b](c,a):a.forEach(function(a){networkMap.datasource[b](c,a)})}.bind(this))}.bind(this)),this)},updateBgColor:function(a,b){b?a.svg.fill(b):a.svg.fill(this.options.background)}}),networkMap.Link.defaultTemplate={width:{label:"Width",type:"number",min:0},inset:{label:"Inset",type:"number",min:1},connectionDistance:{label:"Chamfer",type:"number",min:0},staticConnectionDistance:{label:"Offset",type:"number",min:1},arrowHeadLength:{label:"Arrow Head",type:"number",min:0}},networkMap.Link.registerLinkGenerator=function(a){networkMap.Link._linkGenerator=networkMap.Link.createLinkGenerator(a)},networkMap.Link.createLinkGenerator=function(a){return function(b){var c=b.properties.get("href");return c?(networkMap.isFunction(c)?b.setLink(c()):b.setLink(c),void 0):(b.setLink(a(b)),void 0)}},networkMap.Link.registerLinkGenerator(function(){return null}),networkMap.Link.defaults=new networkMap.Properties({inset:10,connectionDistance:10,staticConnectionDistance:30,arrowHeadLength:10,width:10,debug:!1,background:"#777",globalRefresh:!0,refreshInterval:3e5,datasource:"simulate",batchUpdate:!0,colormap:"flat5"}),networkMap.Link.Module=networkMap.Link.Module||{},networkMap.Link.Module.Settings=function(a){this.properties=a},networkMap.extend(networkMap.Link.Module.Settings,{parameters:{width:{label:"Width",type:"number",min:0,global:!0},inset:{label:"Inset",type:"number",min:1,global:!0},connectionDistance:{label:"Chamfer",type:"number",min:0,global:!0},staticConnectionDistance:{label:"Offset",type:"number",min:1,global:!0},arrowHeadLength:{label:"Arrow Head",type:"number",min:0,global:!0}},toElement:function(a,b){var c,d=new networkMap.widget.Accordion,e=function(a,b){return function(c,d){b.set(a,d.value())}};c=d.add("Globals"),networkMap.each(this.parameters,function(a,d){c.appendChild(new networkMap.widget.IntegerInput(a.label,b.get(d,!0),a).addEvent("change",e(d,b)))}.bind(this));var f={id:{label:"Node",type:"text",disabled:!0,global:!1},name:{label:"Interface",type:"text",disabled:!0,global:!1},width:{label:"Width",type:"number",min:0,global:!1}},g=function(g,h){c=d.add(g),networkMap.each(f,function(d,f){["id"].some(function(a){return a==f})?c.appendChild(new networkMap.widget.TextInput(d.label,b.get(h+"."+f),d).addEvent("change",e(f,a.properties))):"number"===d.type?c.appendChild(new networkMap.widget.IntegerInput(d.label,a.path.nodeA.properties.get(f,!0),d).addEvent("change",e(f,a.path[h].properties))):"text"===d.type?c.appendChild(new networkMap.widget.TextInput(d.label,a.path.nodeA.properties.get(f),d).addEvent("change",e(f,a.path[h].properties))):"color"===d.type&&c.appendChild(new networkMap.widget.ColorInput(d.label,a.path.nodeA.properties.get(f),d).addEvent("change",e(f,a.path[h].properties)))}.bind(this))}.bind(this);g("Node A","nodeA"),g("Node B","nodeB");var h;return a.subpath.nodeA&&a.subpath.nodeB&&a.subpath.nodeA.length===a.subpath.nodeB.length?(c=d.add("Sublinks"),h=new networkMap.widget.List,a.subpath.nodeA.forEach(function(b,c){h.add(b.properties.get("name")+" - "+a.subpath.nodeB[c].properties.get("name"),{enableDelete:!1})}),c.appendChild(h)):((a.subpath.nodeA||a.subpath.nodeB)&&(c=d.add("Sublinks"),h=new networkMap.widget.List),a.subpath.nodeA&&a.subpath.nodeA.forEach(function(a){h.add(a.properties.get("name")+" - "+"N/A",{enableDelete:!1})}),a.subpath.nodeB&&a.subpath.nodeB.forEach(function(a){h.add("N/A - "+a.properties.get("name"),{enableDelete:!1})
}),(a.subpath.nodeA||a.subpath.nodeB)&&c.appendChild(h)),d}});