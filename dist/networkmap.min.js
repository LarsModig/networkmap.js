/*! networkmap 2013-10-01 */
var networkMap=networkMap||{};networkMap.path=function(a){return a.path().attr({fill:"none",stroke:"#000"})},Array.implement("find",function(a){for(var b=0;b<this.length;b++)if(a.call(this,this[b],b,this))return this[b]}),networkMap.widget=networkMap.widget||{},networkMap.widget.IntegerInput=new Class({Implements:[Options,Events],options:{"class":"nm-input-integer"},wrapper:null,label:null,input:null,initialize:function(a,b,c){this.setOptions(c),this.wrapper=new Element("div",{"class":this.options.class}),this.label=new Element("span",{text:a}),this.input=new Element("input",{type:"number",value:b}).addEvent("change",function(a){this.fireEvent("change",[a])}.bind(this)),void 0!==this.options.min&&this.input.set("min",this.options.min),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.grab(this.label).grab(this.input)},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.TextInput=new Class({Implements:[Options,Events],options:{"class":"nm-input-text",type:"text"},wrapper:null,label:null,input:null,initialize:function(a,b,c){this.setOptions(c),this.wrapper=new Element("div",{"class":this.options.class}),this.label=new Element("span",{text:a}),this.input=new Element("input",{type:this.options.type,value:b}).addEvent("change",function(a){this.fireEvent("change",[a])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.grab(this.label).grab(this.input)},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.ColorInput=new Class({Implements:[Options,Events],options:{"class":"nm-input-color"},wrapper:null,label:null,input:null,initialize:function(a,b,c){this.setOptions(c),this.wrapper=new Element("div",{"class":this.options.class}),this.label=new Element("span",{text:a}),this.div=new Element("div"),this.input=new Element("input",{type:"color",value:b}).addEvent("change",function(a){this.fireEvent("change",[a])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.wrapper.grab(this.label).grab(this.div.grab(this.input))},toElement:function(){return this.wrapper}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Accordion=new Class({Implements:[Options,Events],options:{"class":"nm-accordion"},wrapper:null,items:[],initialize:function(a){this.setOptions(a),this.wrapper=new Element("div",{"class":this.options.class})},toElement:function(){return this.wrapper},add:function(a,b){var c=new Element("div",{"class":"nm-accordion-group nm-accordion-open"}),d=new Element("div",{"class":"nm-accordion-trigger unselectable",text:a}),e=new Element("ul",{"class":"nm-accordion-inner"});return b&&b.id&&e.set("id",b.id),c.grab(d),c.grab(e),this.items.push(c),this.wrapper.grab(c),d.addEvent("click",this.clickHandler.bind(this)),e},clickHandler:function(a){a.target.getParent().toggleClass("nm-accordion-open")}}),networkMap.widget=networkMap.widget||{},networkMap.widget.List=new Class({Implements:[Options,Events],options:{"class":"nm-list"},list:null,listItems:[],initialize:function(a){this.setOptions(a),this.list=new Element("ul",{"class":this.options.class})},toElement:function(){return this.list},add:function(a,b){var c=new networkMap.widget.ListItem(a,b);return c.addEvent("remove",this.remove.bind(this)),this.listItems.push(c),this.list.grab(c),c},remove:function(a){return this.listItems=this.listItems.erase(a),this}}),networkMap.widget.ListItem=new Class({Implements:[Options,Events],options:{"class":"nm-list-item",enableDelete:!1},initialize:function(a,b){this.setOptions(b),this.listItem=new Element("li",{"class":this.options.class}),"string"==typeof a?this.listItem.set("text",a):this.listItem.grab(a),this.options.enableDelete&&this.listItem.grab(new Element("span",{text:"x","class":"nm-list-item-delete pull-right",events:{click:this.remove.bind(this)}}))},remove:function(){return this.listItem.destroy(),delete this.listItem,this.fireEvent("remove",[this]),this},toElement:function(){return this.listItem}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Select=new Class({Implements:[Options,Events],options:{"class":"nm-input-select"},wrapper:null,label:null,input:null,initialize:function(a,b,c){this.setOptions(c),this.wrapper=new Element("div",{"class":this.options.class}),this.label=new Element("span",{text:a}),this.input=new Element("select").addEvent("change",function(a){this.fireEvent("select",[a,this])}.bind(this)),this.options.disabled===!0&&(this.input.disabled=!0),this.addOptions(b),this.wrapper.grab(this.label).grab(this.input)},addOptions:function(a){a.each(function(a){this.addOption(a)}.bind(this))},addOption:function(a,b){return this.input.grab(new Element("option",{value:a,text:a,selected:b})),this},getSelected:function(){return this.input.getSelected()[0].value},clearOptions:function(){return this.input.empty(),this},toElement:function(){return this.wrapper},toString:function(){return this.getSelected()}}),networkMap.widget=networkMap.widget||{},networkMap.widget.Modal=new Class({Implements:[Options,Events],options:{"class":"modal",title:"",content:"",footer:"",type:"alert"},initialize:function(a){this.setOptions(a),this.buildUI()},buildUI:function(){var a=this.modal=new Element("div",{"class":"modal hide fade in",styles:{zIndex:1e6}}),b=this.header=new Element("div",{"class":"modal-header"});this.closeButton=new Element("button",{"class":"close",html:"&times;"}).addEvent("click",this._close.bind(this)).inject(b),this.title=new Element("h3",{html:this.options.title}).inject(b);var c=this.body=new Element("div",{"class":"modal-body",html:this.options.content}),d=this.footer=new Element("div",{"class":"modal-footer",html:this.options.footer});return a.grab(b).grab(c).grab(d),this},alert:function(a,b){return b=b||{},this.body.set("html",a),this.title.set("html",b.title?b.title:"Alert"),new Element("a",{href:"#","class":"btn",text:b.button?b.button:"Ok"}).addEvent("click",this.destroy.bind(this)).inject(this.footer),document.body.grab(this.modal),this.show()},confirm:function(a,b){return b=b||{},this.body.set("html",a),this.title.set("html",b.title?b.title:"Alert"),new Element("a",{href:"#","class":"btn",text:b.button?b.cancelButton:"Cancel"}).addEvent("click",this._cancel.bind(this)).inject(this.footer),new Element("a",{href:"#","class":"btn",text:b.button?b.okButton:"Ok"}).addEvent("click",this._ok.bind(this)).inject(this.footer),document.body.grab(this.modal),this.show()},show:function(){return this.modal.setStyle("display","block"),this},destroy:function(){return this.modal.destroy(),this},_close:function(a){this.fireEvent("close",[a]),this.destroy()},_ok:function(a){this.fireEvent("ok",[a]),this.destroy()},_cancel:function(a){this.fireEvent("cancel",[a]),this.destroy()}}),networkMap.datasource=networkMap.datasource||{},networkMap.registerDatasource=function(a,b){networkMap.datasource[a]=function(a,c){"array"!==typeOf(c)&&(c=[c]),b(a,c)}},networkMap.registerDatasource("simulate",function(a,b){b.each(function(b){var c=Math.random();b.callback({url:a,request:b.link,value:c,realValue:Math.round(100*c)+"Mbps"})})}),networkMap.events=networkMap.events||{click:function(a,b){b.options.events.click.href&&(window.location.href=b.options.events.click.href)},hover:function(a,b,c){c.set("text",b.options.name)},mouseover:function(){},mouseout:function(){}},networkMap.registerEvent=function(a,b){if(!networkMap.events[a])throw"Invalid event: "+a+" is not an registered event";"click"===a?networkMap.events[a]=function(a,c){b(a,c)}:"hover"===a?(networkMap.events.mouseover=function(a,c){var d=document.id("nm-active-hover");if(a.target.instance.attr("id"),d){if(!d||d.retrieve("id")===a.target.instance.attr("id"))return d.store("keep",!0),void 0;d.destroy()}d=new Element("div",{id:"nm-active-hover","class":"nm-hover",events:{mouseover:function(){d.store("mouseover",!0)},mouseout:function(){d.eliminate("mouseover"),function(){d.retrieve("keep")?d.eliminate("keep"):d.destroy()}.delay(10)},click:function(){c._clickHandler(a)}}}).store("id",a.target.instance.attr("id")),d.setStyles({top:-1e3,left:-1e3}),document.id(document.body).grab(d),b(a,c,d);var e=d.getSize(),f=a.target.getBoundingClientRect();d.setStyles({top:(f.top+f.bottom)/2-e.y/2,left:(f.left+f.right)/2-e.x/2})},networkMap.events.mouseout=function(a){a.target.instance.link,function(){var b=document.id("nm-active-hover");b&&b.retrieve("id")!==a.target.instance.attr("id")||b&&!b.retrieve("mouseover")&&b.destroy()}.delay(10)}):networkMap.events[a]=b},networkMap.registerEvent("click",networkMap.events.click),networkMap.registerEvent("mouseover",networkMap.events.mouseover),networkMap.registerEvent("mouseout",networkMap.events.mouseout),networkMap.registerEvent("hover",networkMap.events.hover),networkMap.colormap=networkMap.colormap||{},networkMap.registerColormap=function(a,b){networkMap.colormap[a]=b},networkMap.colormap.rasta5={translate:function(a){return a?.2>a?networkMap.colormap.rasta5.map[0]:.4>a?networkMap.colormap.rasta5.map[1]:.6>a?networkMap.colormap.rasta5.map[2]:.8>a?networkMap.colormap.rasta5.map[3]:networkMap.colormap.rasta5.map[4]:networkMap.colormap.rasta5.nodata},map:["#3DDE1E","#9BEC1A","#F9EB18","#F98020","#F51329"],limits:[.2,.4,.6,.8,1],nodata:"#C0C0C0"},networkMap.colormap.flat5={translate:function(a){var b=networkMap.colormap.flat5;return a?.2>a?b.map[0]:.4>a?b.map[1]:.6>a?b.map[2]:.8>a?b.map[3]:b.map[4]:b.nodata},map:["#27ae60","#2ecc71","#f1c40f","#e67e22","#c0392b"],limits:[.2,.4,.6,.8,1],nodata:"#ecf0f1"},networkMap.ColorLegend=new Class({Implements:[Options],options:{boxSize:25,margin:10,target:null},graph:null,initialize:function(a,b){if(this.graph=b.graph,delete b.graph,this.setOptions(b),this.colormap=networkMap.colormap[a],!this.colormap)throw'Colormap "'+a+'" is not registerd';this.draw(),function(){var a=this.svg.bbox();return 0===a.x&&0===a.y?this:(this._move(),void 0)}.bind(this).delay(0)},draw:function(){var a=this.colormap.map,b=this.container=new Element("div",{"class":"nm-colormap"}).inject(this.options.target),c=this.svg=SVG(b).group();return a.each(function(b,d){c.rect(this.options.boxSize,this.options.boxSize).attr({fill:b,"stroke-width":1}).move(0,(a.length-1-d)*this.options.boxSize),c.line(-5,(a.length-1-d)*this.options.boxSize,0,(a.length-1-d)*this.options.boxSize).attr({stroke:"#000"}),c.text(100*this.colormap.limits[d].toString()+"%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-1.3-d)*this.options.boxSize,"end")}.bind(this)),c.line(-5,a.length*this.options.boxSize,0,a.length*this.options.boxSize).attr({stroke:"#000"}),c.text("0%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-.3)*this.options.boxSize,"end"),this._move(),this},_move:function(){var a=this.svg.bbox();return this.container.setStyles({width:a.width,height:a.height}),this.svg.move(Math.abs(a.x),Math.abs(a.y)),this}}),networkMap.SettingsManager=new Class({Implements:[Options,Events],options:{},container:null,editing:!1,initialize:function(a,b){this.setOptions(b),this.container=a,this.nav=this.createMenu(),a.grab(this.nav)},createMenu:function(){var a=new Element("nav",{"class":"nm-menu"}),b=new Element("div",{"class":"nm-trigger",html:'<span class="nm-icon nm-icon-menu"></span><a class="nm-label">Settings</a>',events:{click:this.toggle.bind(this)}}),c=this.menu=new Element("ul");c.grab(new Element("ul",{"class":"nm-object-properties",id:"nm-edit-content"}));var d=this.menuButtons=new Element("li",{"class":"clearfix nm-menu-buttons"}),e=this.btnSave=new Element("button",{text:"Save","class":"btn btn-primary pull-right",events:{click:this.save.bind(this)}});return c.grab(d.grab(e)),a.grab(b),a.grab(c),a},getContentContainer:function(){return this.nav.getElement("#nm-edit-content")},edit:function(a){this.editing=a;var b=this.getContentContainer();return this.clear(),this.displayButtons(),b.grab(a.getSettingsWidget()),this.fireEvent("edit",[a]),this},clear:function(){return this.getContentContainer().empty(),this},hideButtons:function(a){return this.menuButtons.setStyle("display","none"),this.showButtonsCallback=a?a:function(){},this},displayButtons:function(){return this.showButtonsCallback?(this.showButtonsCallback(),delete this.showButtonsCallback,this.menuButtons.setStyle("display","block"),this):this},defaultView:function(){this.clear(),this.fireEvent("defaultView",[this])},toggle:function(){return this.nav.hasClass("nm-menu-open")?this.disable():this.enable()},enable:function(){return this.nav.addClass("nm-menu-open"),this.fireEvent("active"),this.fireEvent("defaultView",[this]),this},disable:function(){return this.nav.removeClass("nm-menu-open"),this.nav.getElement("#nm-edit-content").empty(),this.fireEvent("deactive"),this},save:function(){return this.fireEvent("save"),this}}),networkMap.Graph=new Class({Implements:[Options,Events],options:{width:10,height:10,datasource:"simulate",colormap:"flat5",enableEditor:!0,allowDraggableNodes:!1,refreshInterval:null},defaults:{node:{padding:10,fontSize:16,bgColor:"#dddddd",strokeColor:"#000000",strokeWidth:2},link:{width:10,inset:10,connectionDistance:10,staticConnectionDistance:30,arrowHeadLength:10}},exportedOptions:[],nodes:[],links:[],saveData:{},_mode:"normal",initialize:function(a,b){this.setOptions(b),this.element=document.id(a),this.container=new Element("div",{"class":"nm-container"}),this.element.grab(this.container),this.svg=SVG(this.container),this.graph=this.svg.group(),this.legend=new networkMap.ColorLegend(this.options.colormap,{graph:this,target:this.container}),this.options.enableEditor&&(this.settings=new networkMap.SettingsManager(this.container),this.settings.addEvent("defaultView",function(){this.settings.edit(this)}.bind(this)),this.settings.addEvent("active",this.enableEditor.bind(this)),this.settings.addEvent("deactive",this.disableEditor.bind(this)),this.settings.addEvent("save",this.save.bind(this))),this.addEvent("resize",this.rescale.bind(this)),this.setRefreshInterval(this.options.refreshInterval),this.svg.on("click",this._clickHandler.bind(this))},setDefaults:function(a,b){if(!this.defaults[a])throw"Illigal element";return Object.merge(this.defaults[a],b),this.fireEvent("redraw",[{defaultsUpdated:!0}]),this},getDefaults:function(a){if(!this.defaults[a])throw"Illigal element";return this.defaults[a]},setRefreshInterval:function(a){return this.options.interval=a,a?this.intervalId=setInterval(function(){this.refresh()}.bind(this),1e3*a):this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId),this},triggerEvent:function(a,b){return b.fireEvent(a,b),this},rescale:function(){var a=this.element.getSize();this.svg.size(a.x,a.y);var b=this.graph.bbox();return a.x<b.width+Math.abs(b.x)||a.y<b.height+Math.abs(b.y)?this.svg.viewbox(b.x,b.y,b.width+Math.abs(b.x),b.height+Math.abs(b.y)):this.svg.viewbox(b.x<0?b.x:0,b.y<0?b.y:0,a.x,a.y),this},getSVG:function(){return this.svg},getPaintArea:function(){return this.graph},settingsManager:function(){return this.settings()},getSettingsWidget:function(){var a,b=new networkMap.widget.Accordion,c=function(a,b){return function(c){a[b]=c.target.value,this.fireEvent("redraw",[{defaultsUpdated:!0}])}.bind(this)}.bind(this);return a=b.add("Node Defaults"),Object.each(networkMap.Node.defaultTemplate,function(b,d){"number"===b.type?a.grab(new networkMap.widget.IntegerInput(b.label,this.defaults.node[d],b).addEvent("change",c(this.defaults.node,d))):"text"===b.type?a.grab(new networkMap.widget.TextInput(b.label,this.defaults.node[d],b).addEvent("change",c(this.defaults.node,d))):"color"===b.type&&a.grab(new networkMap.widget.ColorInput(b.label,this.defaults.node[d],b).addEvent("change",c(this.defaults.node,d)))}.bind(this)),a=b.add("Link Defaults"),Object.each(networkMap.Link.defaultTemplate,function(b,d){"number"===b.type?a.grab(new networkMap.widget.IntegerInput(b.label,this.defaults.link[d],b).addEvent("change",c(this.defaults.link,d))):"text"===b.type?a.grab(new networkMap.widget.TextInput(b.label,this.defaults.link[d],b).addEvent("change",c(this.defaults.link,d))):"color"===b.type&&a.grab(new networkMap.widget.ColorInput(b.label,this.defaults.link[d],b).addEvent("change",c(this.defaults.link,d)))}.bind(this)),b},load:function(a){if("string"===typeOf(a))return this.loadUrl(a);if("object"===typeOf(a))return this.loadObject(a);throw new TypeError("Unknown type "+typeOf(a))},loadUrl:function(a){return new Request.JSON({url:a,onSuccess:function(a){this.loadObject(a)}.bind(this),onFailure:function(){},onComplete:function(){},onError:function(){}}).get({}),this},loadObject:function(a){return this.setOnSave(a.onSave),a.defaults&&(this.setDefaults("node",a.defaults.node||this.defaults.node),this.setDefaults("link",a.defaults.link||this.defaults.link)),a.nodes.each(function(a){a.graph=this,a.draggable=this.options.allowDraggableNodes,this.addNode(new networkMap.Node(a),!1)}.bind(this)),a.links.each(function(a){a.graph=this,this.addLink(new networkMap.Link(a),!1)}.bind(this)),this.fireEvent("load",[this]),this.triggerEvent("resize",this),this},setOnSave:function(a){return a&&this.validateSave(a)&&(this.saveData=a),this},getOnSave:function(){return this.saveData?this.saveData:{}},validateSave:function(a){return a.method&&"post"!=a.method&&"get"!=a.method?(this.saveEnabled=!1,alert("Illigal argument: "+a.method+". Valid onSave.method arguments are: post, get"),!1):(a.method="post",a.data=a.data||{},a.url?!0:(this.saveEnabled=!1,alert("Missing argument onSave.url"),!1))},save:function(){if(!this.saveData)return!1;var a=this.getConfiguration(),b=this.settings.btnSave.get("html");return this.settings.btnSave.set("text","....."),new Request.JSON({url:this.saveData.url,method:this.saveData.method,data:a,onSuccess:function(a){this.settings.btnSave.set("html",b),"ok"===a.status&&(new networkMap.widget.Modal).alert("Weathermap saved"),"nok"===a.status&&(new networkMap.widget.Modal).alert(a.error,{title:"Error"}),"deleted"==a.status&&(new networkMap.widget.Modal).alert("The networkmap is deleted",{title:"Error"})}.bind(this),onFailure:function(){},onComplete:function(){},onError:function(){}}).send(),!0},enableEditor:function(){return this.enableDraggableNodes(),this.nodes.each(function(a){a.mode("edit")}),this.links.each(function(a){a.mode("edit")}),this._mode="edit",this},disableEditor:function(){return this.disableDraggableNodes(),this.nodes.each(function(a){a.mode("normal")}),this.links.each(function(a){a.mode("normal")}),this._mode="normal",this},_clickHandler:function(a){"edit"===this._mode&&(a.target.instance===this.svg||a.target.instance===this.graph)&&this.settings.edit(this)},enableDraggableNodes:function(){return this.nodes.each(function(a){a.draggable()}),this},disableDraggableNodes:function(){return this.nodes.each(function(a){a.fixed()}),this},getConfiguration:function(){var a={defaults:this.defaults,nodes:[],links:[],onSave:this.saveData};return this.exportedOptions.each(function(b){a[b]=this.options[b]}.bind(this)),a.onSave=this.saveData,this.nodes.each(function(b){a.nodes.push(b.getConfiguration())}),this.links.each(function(b){a.links.push(b.getConfiguration())}),a},addNode:function(a,b){return this.nodes.push(a),b!==!1&&this.triggerEvent("resize",this),this},getNode:function(a){return this.nodes.find(function(b){return b.options.id===a?!0:void 0})},removeNode:function(a){return this.nodes.erase(a),a.setGraph(null),this.getLinks(a).each(function(a){this.removeLink(a)}.bind(this)),this},addLink:function(a,b){return this.links.push(a),b!==!1&&this.triggerEvent("resize",this),this},getLink:function(a,b){return this.links.find(function(c){return c.nodeA.options.id===a&&c.nodeB.options.id===b?!0:c.nodeA.options.id===b&&c.nodeB.options.id===a?!0:void 0})},getLinks:function(a,b){var c=[];return this.links.each(function(d){d.connectedTo(a,b)&&c.push(d)}),c},removeLink:function(a){return this.links.erase(a),a.setGraph(null),this},refresh:function(){return this.links.each(function(a){a.localUpdate()}),this},update:function(){var a={};this.links.each(function(b){[b.options.nodeA,b.options.nodeB].each(function(b){a[b.requestUrl]||(a[b.requestUrl]=[]),a[b.requestUrl].push(b.requestData)})}),Object.each(a,function(a,b){a.callback=function(){},networkMap.datasource[this.options.datasource](b,a)}.bind(this))}}),networkMap.Node=new Class({Implements:[Options,Events],options:{graph:null,id:null,name:null,comment:null,x:null,y:null,lat:null,lng:null,weight:null,fontFamily:"Helvetica",fontSize:16,bgColor:"#dddddd",strokeColor:"#000000",strokeWidth:2,information:{},data:{},label:{position:"internal",visable:!0},renderer:"rect",padding:10,href:null,style:null,debug:!1,draggable:!1,events:null},_mode:"normal",exportedOptions:["id","name","comment","x","y","lat","lng","weight","renderer","information","label","padding","href","style","events","fontFamily","fontSize","bgColor","strokeColor","strokeWidth"],editTemplate:{id:{label:"ID",type:"text",disabled:!0},name:{label:"Name",type:"text"},comment:{label:"Comment",type:"text"},padding:{label:"Padding",type:"number",min:0},fontSize:{label:"Font size",type:"number",min:1},bgColor:{label:"Color",type:"color"},strokeColor:{label:"Stroke color",type:"color"},strokeWidth:{label:"Stroke width",type:"number",min:0}},initialize:function(a){if(this.graph=a.graph,delete a.graph,this._localConfig=a,this.graph&&this.setOptions(this.graph.getDefaults("node")),this.setOptions(a),!this.options.id)throw"Node(create, no id given)";this.options.x=parseFloat(this.options.x),this.options.y=parseFloat(this.options.y),this.options.padding=parseFloat(this.options.padding),this.graph&&(this.draw(),this.graph.addEvent("redraw",function(a){a.defaultsUpdated===!0&&(this.setOptions(this.graph.getDefaults("node")),this.setOptions(this._localConfig)),this.draw()}.bind(this)))},setProperty:function(a,b){if(!this.editTemplate[a])throw"Unknow id: "+a;return this.options[a]=b,this._localConfig[a]=b,this.draw(),this},getProperty:function(a){if(!this.editTemplate[a])throw"Unknown id: "+a;return this._localConfig[a]},getConfiguration:function(){var a={};return this.exportedOptions.each(function(b){this._localConfig[b]&&(a[b]=this._localConfig[b])}.bind(this)),a},getSettingsWidget:function(){var a,b=new networkMap.widget.Accordion,c=function(a,b){return function(c){b.setProperty(a,c.target.value)}};return a=b.add("Globals"),Object.each(this.editTemplate,function(b,d){"number"===b.type?a.grab(new networkMap.widget.IntegerInput(b.label,this.getProperty(d),b).addEvent("change",c(d,this))):"text"===b.type?a.grab(new networkMap.widget.TextInput(b.label,this.getProperty(d),b).addEvent("change",c(d,this))):"color"===b.type&&a.grab(new networkMap.widget.ColorInput(b.label,this.getProperty(d),b).addEvent("change",c(d,this)))}.bind(this)),b},enableEvent:function(a,b){if("hover"!==a&&"click"!==a)throw"Unknown event";this.options.events=this.options.events||{},this._localConfig.events=this._localConfig.events||{};var c={enabled:!0};return this.options.events[a]=b||c,this._localConfig.events[a]=b||c,this},disableEvent:function(a){return this.options.events&&this.options.events[a]&&(delete this.options.events[a],delete this._localConfig.events[a]),this},setGraph:function(a){return this.graph=null,this.draw(),a&&(this.graph=a,this.draw()),this},mode:function(a){if(!a)return this._mode;if("edit"!==a&&"normal"!==a)throw"Unknown mode: "+a;return this._mode=a,this},_clickhandler:function(a){"normal"===this._mode&&this.options.events&&this.options.events.click?networkMap.events.click(a,this):"edit"===this._mode&&this.graph.settings.edit(this)},x:function(){return this.svg.bbox().x},y:function(){return this.svg.bbox().y},draggable:function(){return this._draggable=!0,this.svg.draggable(),this.svg.remember("cursor",this.svg.style("cursor")),this.svg.style("cursor","move"),this},fixed:function(){this._draggable=!1,this.svg.fixed();var a=this.svg.remember("cursor");return this.svg.forget("cursor"),this.svg.style("cursor",a||"default"),this},isDraggable:function(){return this._draggable},bbox:function(){return this.svg.bbox()},draw:function(){var a=!1;if(this.svg&&!this.graph)return this.svg.remove(),!1;if(!this.graph)return!1;this.debug&&this.debug.remove(),this.options.debug&&(this.debug=this.graph.getPaintArea().group()),this.svg&&(this.svg.remove(),a=!0);var b,c=this.svg=this.graph.getPaintArea().group(),d=c.text(this.options.name).font({family:this.options.fontFamily,size:this.options.fontSize,anchor:"start",leading:this.options.fontSize-1}).move(parseFloat(this.options.padding),parseFloat(this.options.padding)),e=d.bbox();for(this.options.comment&&""!==this.options.comment&&(d.text(function(a){a.tspan(this.options.name).newLine(),b=a.tspan(this.options.comment).newLine().attr("font-size",this.options.fontSize-2)}.bind(this)),b.attr("text-anchor","middle"),b.dx(e.width/2));e.width<d.bbox().width;)b.attr("font-size",b.attr("font-size")-1);e=d.bbox();var f=c.rect(1,1).fill({color:this.options.bgColor}).stroke({color:this.options.strokeColor,width:this.options.strokeWidth}).attr({rx:4,ry:4}).size(e.width+2*this.options.padding,e.height+2*this.options.padding);return d.front(),c.on("click",this._clickhandler.bind(this)),this.options.events&&(c.link=this.options.events,this.options.events.click&&c.attr("cursor","pointer")),f.clone().fill({opacity:0}).front(),c.move(parseFloat(this.options.x),parseFloat(this.options.y)),this.options.draggable&&this.draggable(),c.dragmove=function(a,b){this.fireEvent("drag",[a,b])}.bind(this),c.dragstart=function(){this.fireEvent("dragstart")}.bind(this),c.dragend=function(){this.options.x=this.x(),this.options.y=this.y(),this._localConfig.x=this.x(),this._localConfig.y=this.y(),this.fireEvent("dragend")}.bind(this),this.isDraggable()&&this.draggable(),this.fireEvent("dragend"),!0}}),networkMap.Node.defaultTemplate={padding:{label:"Padding",type:"number",min:0},fontSize:{label:"Font size",type:"number",min:1},bgColor:{label:"Color",type:"color"},strokeColor:{label:"Stroke color",type:"color"},strokeWidth:{label:"Stroke width",type:"number",min:0}},networkMap.Node.renderer=networkMap.Node.renderer||{},networkMap.registerNodeRenderer=function(a,b){networkMap.Node.renderer[a]=b},networkMap.Node.renderer.rect=function(){},networkMap.Node.label=networkMap.Node.label||{},networkMap.Node.label.rederer=networkMap.Node.label.rederer||{},networkMap.Node.label.rederer.normal=function(){},networkMap.LinkPath=new Class({Implements:[Options,Events],options:{},svg:null,initialize:function(a,b,c){this.setOptions(c),this.link=a,this.svg=b,this.options.requestUrl&&this.link.registerUpdateEvent(a.options.datasource,this.options.requestUrl,this,function(a){this.link.updateBgColor(this,this.link.options.colormap.translate(a.value))}.bind(this)),this.setupEvents()},remove:function(){this.svg.remove()},getEditables:function(){var a={width:{label:"Local width",type:"int"}};return a},getLink:function(){return this.link},getNode:function(){return this.getLink().getNode(this)},getSettingsWidget:function(){return this.getLink().getSettingsWidget()},getProperty:function(a){if("width"==a){var b=this.getMainPath();if(b!=this)return b.getProperty(a);if(!this.options[a])return this.link.options[a]}return this.options[a]?this.options[a]:null},setProperty:function(a,b){if("width"==a){var c=this.getMainPath();if(c!=this)return c.setProperty(a,b)}return this.options[a]=b,this.fireEvent("change",[a]),this},getConfiguration:function(){return this.options},getMainPath:function(){var a;return this.link.subpath.nodeA&&(this.link.subpath.nodeA.each(function(b){this==b&&(a=this.link.path.nodeA)}.bind(this)),a)?a:this.link.subpath.nodeB&&(this.link.subpath.nodeB.each(function(b){this==b&&(a=this.link.path.nodeB)}.bind(this)),a)?a:this},setupEvents:function(){this.svg.on("click",this._clickHandler.bind(this)),this.options.events&&(this.options.events.click&&this.svg.attr("cursor","pointer"),this.options.events.hover&&(this.svg.on("mouseover",this._hoverHandler.bind(this)),this.svg.on("mouseout",this._hoverHandler.bind(this))))},_clickHandler:function(a){"normal"===this.link.mode()&&this.options.events&&this.options.events.click?networkMap.events.click(a,this):"edit"===this.link.mode()&&this.link.graph.settings.edit(this)},_hoverHandler:function(a){"edit"!==this.link.mode()&&("mouseover"===a.type&&networkMap.events.mouseover(a,this),"mouseout"===a.type&&networkMap.events.mouseout(a,this))}}),networkMap.Link=new Class({Implements:[Options],options:{inset:10,connectionDistance:10,staticConnectionDistance:30,arrowHeadLength:10,width:10,debug:!1,background:"#777",localUpdate:!0,refreshInterval:3e5,datasource:null,colormap:null},exportedOptions:["inset","connectionDistance","staticConnectionDistance","arrowHeadLength","width","background"],editTemplate:{width:{label:"Width",type:"number",min:0},inset:{label:"Inset",type:"number",min:1},connectionDistance:{label:"Chamfer",type:"number",min:0},staticConnectionDistance:{label:"Offset",type:"number",min:1},arrowHeadLength:{label:"Arrow Head",type:"number",min:0}},pathPoints:[],svgEl:{},updateQ:{},_mode:"normal",path:{},subpath:{},initialize:function(a){var b;if(this.graph=a.graph,delete a.graph,this.options.datasource=this.options.datasource||this.graph.options.datasource,this.svg=this.graph.getPaintArea().group(),!a.nodeA||!a.nodeB)throw"Link(create, missing node in link definition)";if(this.nodeA=this.graph.getNode(a.nodeA.id),!this.nodeA)throw"Link(create, nodeA does not exist ("+this.options.nodeA.id+")";if(b=a.nodeA,this.options.nodeA=b.id,b.sublinks&&(sublinks=b.sublinks,delete b.sublinks,this.subpath.nodeA=[],sublinks.each(function(a){this.subpath.nodeA.push(new networkMap.LinkPath(this,networkMap.path(this.svg),a).addEvent("change",this.redraw.bind(this)))}.bind(this))),this.path.nodeA=new networkMap.LinkPath(this,networkMap.path(this.svg),b).addEvent("change",this.redraw.bind(this)),(this.options.nodeA.requestData||this.options.nodeA.sublinks)&&(this.svgEl.nodeA={},this.options.nodeA.sublinks&&(this.svgEl.nodeA.sublinks=[])),this.nodeB=this.graph.getNode(a.nodeB.id),!this.nodeB)throw"Link(create, nodeB does not exist ("+this.options.nodeB.id+")";b=a.nodeB,this.options.nodeB=b.id,b.sublinks&&(sublinks=b.sublinks,delete b.sublinks,this.subpath.nodeB=[],sublinks.each(function(a){this.subpath.nodeB.push(new networkMap.LinkPath(this,networkMap.path(this.svg),a).addEvent("change",this.redraw.bind(this)))}.bind(this))),this.path.nodeB=new networkMap.LinkPath(this,networkMap.path(this.svg),b).addEvent("change",this.redraw.bind(this)),(this.options.nodeB.requestData||this.options.nodeB.sublinks)&&(this.svgEl.nodeB={},this.options.nodeB.sublinks&&(this.svgEl.nodeB.sublinks=[])),this.graph&&this.setOptions(this.graph.getDefaults("link")),this._localConfig=a,this.setOptions(a),this.options.colormap||(this.options.colormap=networkMap.colormap[this.graph.options.colormap]),this.datasource=networkMap.datasource[this.options.datasource],this.graph&&(this.draw(),this.graph.addEvent("redraw",function(a){a.defaultsUpdated===!0&&(this.setOptions(this.graph.getDefaults("link")),this.setOptions(this._localConfig))}.bind(this)))},getSettingsWidget:function(){var a,b=new networkMap.widget.Accordion,c=function(a,b){return function(c){b.setProperty(a,c.target.value)}};a=b.add("Globals"),Object.each(this.editTemplate,function(b,d){a.grab(new networkMap.widget.IntegerInput(b.label,this.getProperty(d),b).addEvent("change",c(d,this)))}.bind(this));var d={id:{label:"Node",type:"text",disabled:!0},name:{label:"Interface",type:"text",disabled:!0},width:{label:"Width",type:"number",min:0}};if(a=b.add("Node A"),Object.each(d,function(b,d){["id"].some(function(a){return a==d})?a.grab(new networkMap.widget.TextInput(b.label,this.nodeA.getProperty(d),b).addEvent("change",c(d,this.nodeA))):"number"===b.type?a.grab(new networkMap.widget.IntegerInput(b.label,this.path.nodeA.getProperty(d),b).addEvent("change",c(d,this.path.nodeA))):"text"===b.type?a.grab(new networkMap.widget.TextInput(b.label,this.path.nodeA.getProperty(d),b).addEvent("change",c(d,this.path.nodeA))):"color"===b.type&&a.grab(new networkMap.widget.ColorInput(b.label,this.path.nodeA.getProperty(d),b).addEvent("change",c(d,this.path.nodeA)))
}.bind(this)),a=b.add("Node B"),Object.each(d,function(b,d){["id"].some(function(a){return a==d})?a.grab(new networkMap.widget.TextInput(b.label,this.nodeB.getProperty(d),b).addEvent("change",c(d,this.nodeB))):"number"===b.type?a.grab(new networkMap.widget.IntegerInput(b.label,this.path.nodeB.getProperty(d),b).addEvent("change",c(d,this.path.nodeB))):"text"===b.type?a.grab(new networkMap.widget.TextInput(b.label,this.path.nodeB.getProperty(d),b).addEvent("change",c(d,this.path.nodeB))):"color"===b.type&&a.grab(new networkMap.widget.ColorInput(b.label,this.path.nodeB.getProperty(d),b).addEvent("change",c(d,this.path.nodeB)))}.bind(this)),this.subpath.nodeA){a=b.add("Sublinks");var e=new networkMap.widget.List;this.subpath.nodeA.each(function(a,b){e.add(a.options.name+" - "+this.subpath.nodeB[b].options.name,{enableDelete:!1})}.bind(this)),a.grab(e)}return b},getEditables:function(){return this.editTemplate},setProperty:function(a,b){if(!this.editTemplate[a])throw"Unknow id: "+a;this.options[a]=b,this._localConfig[a]=b,this.redraw()},getProperty:function(a){if(!this.editTemplate[a])throw"Unknow id: "+a;return this._localConfig[a]},getNode:function(a){var b=function(b){return b===a?!0:void 0};if(this.path.nodeA===a)return this.nodeA;if(this.subpath.nodeA&&this.subpath.nodeA.some(b,this))return this.nodeA;if(this.path.nodeB===a)return this.nodeB;if(this.subpath.nodeB&&this.subpath.nodeB.some(b,this))return this.nodeB;throw"Link is not found"},connectedTo:function(a,b){return b?!(this.nodeA!=a&&this.nodeB!=a||this.nodeA!=b&&this.nodeB!=b):this.nodeA==a||this.nodeB==a},mode:function(a){if(!a)return this._mode;if("edit"!==a&&"normal"!==a)throw"Unknown mode: "+a;return this._mode=a,this},getConfiguration:function(){var a={};return this.exportedOptions.each(function(b){this._localConfig[b]&&(a[b]=this._localConfig[b])}.bind(this)),this.path.nodeA&&(a.nodeA=this.path.nodeA.getConfiguration()),this.subpath.nodeA&&(a.nodeA=a.nodeA||{},a.nodeA.sublinks=[],this.subpath.nodeA.each(function(b){a.nodeA.sublinks.push(b.getConfiguration())})),this.path.nodeB&&(a.nodeB=this.path.nodeB.getConfiguration()),this.subpath.nodeB&&(a.nodeB=a.nodeB||{},a.nodeB.sublinks=[],this.subpath.nodeB.each(function(b){a.nodeB.sublinks.push(b.getConfiguration())})),a},setGraph:function(a){this.graph=null,this.draw(),a&&(this.graph=a,this.draw())},_cleanDebugLayer:function(){this.debug&&this.debug.clear(),this.options.debug&&!this.debug&&(this.debug=this.graph.getPaintArea().group())},redraw:function(){return this.redrawShadowPath(),this.drawMainPath(),this.drawSublinks(),this},draw:function(){if(this.svg&&!this.graph)return this.svg.remove(),!1;if(!this.graph)return!1;this._cleanDebugLayer();var a=this.svg;a.back(),this.nodeA.bbox(),this.nodeB.bbox(),this.shadowPath=a.path().attr({fill:"none",stroke:"#000","stroke-dasharray":"3,5","stroke-width":2}),this.redrawShadowPath().hideShadowPath(),this.drawMainPath(),this.drawSublinks(),this.localUpdate(),this.nodeA.addEvent("drag",function(){this._cleanDebugLayer(),this.redrawShadowPath()}.bind(this)),this.nodeB.addEvent("drag",function(){this._cleanDebugLayer(),this.redrawShadowPath()}.bind(this)),this.nodeA.addEvent("dragstart",function(){this.shadowPath.show(),this.hidePaths()}.bind(this)),this.nodeB.addEvent("dragstart",function(){this.shadowPath.show(),this.hidePaths()}.bind(this)),this.nodeA.addEvent("dragend",function(){this.redrawShadowPath().hideShadowPath(),this.drawMainPath(),this.drawSublinks(),this.showPaths()}.bind(this)),this.nodeB.addEvent("dragend",function(){this.redrawShadowPath().hideShadowPath(),this.drawMainPath(),this.drawSublinks(),this.showPaths()}.bind(this))},redrawShadowPath:function(){this.pathPoints.length=0,networkMap.Point;var a=this.nodeA.bbox(),b=this.nodeB.bbox(),c=SVG.math.angle(a,b);return c=SVG.math.snapToAngle(c,[0,Math.PI/2,Math.PI,3*Math.PI/2]),this.options.inset?this.pathPoints.push(new SVG.math.Point(-this.options.inset*Math.cos(c)+a.cx+Math.cos(c)*a.width/2,-this.options.inset*Math.sin(c)+a.cy+Math.sin(c)*a.height/2)):this.pathPoints.push(new SVG.math.Point(a.cx,a.cy)),this.pathPoints.push(new SVG.math.Point(this.options.connectionDistance*Math.cos(c)+a.cx+Math.cos(c)*a.width/2,this.options.connectionDistance*Math.sin(c)+a.cy+Math.sin(c)*a.height/2)),this.pathPoints.push(new SVG.math.Point(this.options.staticConnectionDistance*Math.cos(c)+a.cx+Math.cos(c)*a.width/2,this.options.staticConnectionDistance*Math.sin(c)+a.cy+Math.sin(c)*a.height/2)),this.pathPoints.push(new SVG.math.Point(-this.options.staticConnectionDistance*Math.cos(-c)+b.cx-Math.cos(-c)*b.width/2,this.options.staticConnectionDistance*Math.sin(-c)+b.cy+Math.sin(-c)*b.height/2)),this.pathPoints.push(new SVG.math.Point(-this.options.connectionDistance*Math.cos(-c)+b.cx-Math.cos(-c)*b.width/2,this.options.connectionDistance*Math.sin(-c)+b.cy+Math.sin(-c)*b.height/2)),this.options.inset?this.pathPoints.push(new SVG.math.Point(this.options.inset*Math.cos(-c)+b.cx-Math.cos(-c)*b.width/2,-this.options.inset*Math.sin(-c)+b.cy+Math.sin(-c)*b.height/2)):this.pathPoints.push(new SVG.math.Point(b.cx,b.cy)),this.shadowPath.clear().M(this.pathPoints[0]).L(this.pathPoints[2]).L(this.pathPoints[3]).L(this.pathPoints[5]),this},removeMainPath:function(){this.mainPathA&&this.mainPathA.remove(),this.mainPathB&&this.mainPathB.remove()},hidePaths:function(){return this.path.nodeA&&this.path.nodeA.svg.hide(),this.subpath.nodeA&&this.subpath.nodeA.each(function(a){a.svg.hide()}),this.path.nodeB&&this.path.nodeB.svg.hide(),this.subpath.nodeB&&this.subpath.nodeB.each(function(a){a.svg.hide()}),this},showPaths:function(){return this.path.nodeA&&this.path.nodeA.svg.show(),this.subpath.nodeA&&this.subpath.nodeA.each(function(a){a.svg.show()}),this.path.nodeB&&this.path.nodeB.svg.show(),this.subpath.nodeB&&this.subpath.nodeB.each(function(a){a.svg.show()}),this},showShadowPath:function(){return this.shadowPath.show(),this},hideShadowPath:function(){return this.shadowPath.hide(),this},drawMainPath:function(){var a,b=1,c=function(a,c){var d=a.getProperty("width"),e=new SVG.math.Line(c[0],c[2]),f=new SVG.math.Line(c[2],c[3]),g=e.perpendicularLine(c[1],b*d),h=e.perpendicularLine(c[2],b*d),i=f.perpendicularLine(c[2],b*d),j=f.midPoint(),k=f.move(j,f.p1,a.link.options.arrowHeadLength);f.move(j,f.p2,a.link.options.arrowHeadLength);var l=f.perpendicularLine(k,b*d),m=new SVG.math.Line(g.p1,h.p1),n=new SVG.math.Line(i.p1,l.p1),o=n.intersection(m);o.parallel===!0&&(o=g.p1),m=new SVG.math.Line(g.p2,h.p2),n=new SVG.math.Line(i.p2,l.p2);var p=n.intersection(m);p.parallel===!0&&(p=g.p2),a.svg.clear(),a.svg.M(c[0]).L(g.p1).L(o).L(l.p1).L(j).L(l.p2).L(p).L(g.p2).Z().front()},d=function(a,b,c){var d=a.getProperty("width"),e=new SVG.math.Line(b[2],b[3]),f=e.midPoint(),g=e.move(f,e.p1,a.link.options.arrowHeadLength),h=e.perpendicularLine(g,c*d/2),i=new SVG.math.Line(b[2],f).midPoint(),j=e.perpendicularLine(i,c*d/2);a.svg.clear(),a.svg.M(i).L(j.p1).L(h.p1).L(f).L(h.p2).L(j.p2).Z().front()},e=function(){},f=function(){};return this.options.nodeA.requestUrl?(a=[this.pathPoints[0],this.pathPoints[1],this.pathPoints[2],this.pathPoints[3]],this.subpath.nodeA?this.options.nodeB.requestUrl||this.subpath.nodeB?d(this.path.nodeA,a,this.subpath.nodeA.length):f():this.options.nodeB.requestUrl||this.subpath.nodeB?c(this.path.nodeA,a):e()):this.path.nodeA.remove(),this.options.nodeB.requestUrl?(a=[this.pathPoints[5],this.pathPoints[4],this.pathPoints[3],this.pathPoints[2]],this.subpath.nodeB?this.options.nodeA.requestUrl||this.subpath.nodeA?d(this.path.nodeB,a,this.subpath.nodeB.length):f():this.options.nodeA.requestUrl||this.subpath.nodeA?c(this.path.nodeB,a):e()):this.path.nodeB.remove(),this},drawArc:function(){},drawSublinks:function(){var a,b,c,d,e,f=function(d,f,g,h){for(var i=0;c>=-a/2;){var j={width:e,linkCount:a},k=this.calculateSublinkPath(g,c*h,j);b&&(d[i].svg.clear(),c===-.5?d[i].svg.M(f).L(b[0]).L(b[1]).L(b[2]).L(g[g.length-1]).L(k[2]).L(k[1]).L(k[0]).Z().back():d[i].svg.M(f).L(b[0]).L(b[1]).L(b[2]).L(k[2]).L(k[1]).L(k[0]).Z().back(),i+=1),b=k,c-=1}}.bind(this);return this.subpath.nodeA&&(a=this.subpath.nodeA.length,b=null,c=a/2,d=[this.pathPoints[0],this.pathPoints[1],this.pathPoints[2],new SVG.math.Line(this.pathPoints[2],this.pathPoints[3]).midPoint()],e=this.path.nodeA.getProperty("width")||this.options.width,f(this.subpath.nodeA,this.pathPoints[0],d,1)),this.subpath.nodeB&&(a=this.subpath.nodeB.length,b=null,c=a/2,d=[this.pathPoints[5],this.pathPoints[4],this.pathPoints[3],new SVG.math.Line(this.pathPoints[3],this.pathPoints[2]).midPoint()],e=this.path.nodeB.getProperty("width")||this.options.width,f(this.subpath.nodeB,this.pathPoints[5],d,-1)),this},calculateSublinkPath:function(a,b,c){var d=c.width||this.options.width,e=d*b,f=Math.atan2(this.options.arrowHeadLength,Math.abs(d*c.linkCount/2)),g=Math.abs(e*Math.tan(f)),h=new SVG.math.Line(a[0],a[2]),i=new SVG.math.Line(a[2],a[3]),j=h.perpendicularLine(a[1],e),k=h.perpendicularLine(a[2],e),l=i.perpendicularLine(a[2],e),m=i.move(i.p2,i.p1,g),n=i.perpendicularLine(m,e),o=new SVG.math.Line(j.p1,k.p1),p=new SVG.math.Line(l.p1,n.p1),q=p.intersection(o);return q.parallel===!0&&(q=j.p1),[j.round(2).p1,q.round(2),n.round(2).p1]},setInterval:function(){this.intervalId=setInterval(function(){this.localUpdate()}.bind(this),this.options.refreshInterval)},clearInterval:function(){return this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId),this},registerUpdateEvent:function(a,b,c,d){this.updateQ[a]||(this.updateQ[a]={}),this.updateQ[a][b]||(this.updateQ[a][b]=[]),this.updateQ[a][b].push({link:c,callback:d})},localUpdate:function(){Object.each(this.updateQ,function(a,b){if(!networkMap.datasource[b])throw"Unknown datasource ("+b+")";Object.each(a,function(a,c){this.options.batchUpdate?networkMap.datasource[b](c,a):a.each(function(a){networkMap.datasource[b](c,a)})}.bind(this))}.bind(this))},update:function(){return this.svgEl.nodeA.mainPath&&this.datasource(this.options.nodeA.requestUrl,this.options.nodeA.requestData,function(a){this.updateBgColor(this.svgEl.nodeA.mainPath,this.options.colormap.translate(a.value))}.bind(this)),this.svgEl.nodeA.mainPath&&this.datasource(this.options.nodeB.requestUrl,this.options.nodeB.requestData,function(a){this.updateBgColor(this.svgEl.nodeB.mainPath,this.options.colormap.translate(a.value))}.bind(this)),this.options.nodeA.sublinks&&this.options.nodeA.sublinks.each(function(a,b){this.datasource(this.options.nodeA.sublinks[b].requestUrl,this.options.nodeA.sublinks[b].requestData,function(a){this.updateBgColor(this.svgEl.nodeA.sublinks[b],this.options.colormap.translate(a.value))}.bind(this))}.bind(this)),this.options.nodeB.sublinks&&this.options.nodeB.sublinks.each(function(a,b){this.datasource(this.options.nodeB.sublinks[b].requestUrl,this.options.nodeB.sublinks[b].requestData,function(a){this.updateBgColor(this.svgEl.nodeB.sublinks[b],this.options.colormap.translate(a.value))}.bind(this))}.bind(this)),this},updateBgColor:function(a,b){b?a.svg.fill(b):a.svg.fill(this.options.background)}}),networkMap.Link.defaultTemplate={width:{label:"Width",type:"number",min:0},inset:{label:"Inset",type:"number",min:1},connectionDistance:{label:"Chamfer",type:"number",min:0},staticConnectionDistance:{label:"Offset",type:"number",min:1},arrowHeadLength:{label:"Arrow Head",type:"number",min:0}};