/*! networkmap 2013-07-10 */
var networkMap=networkMap||{};networkMap.path=function(a){return a.path().attr({fill:"none",stroke:"#000"})},Array.implement("find",function(a){for(var b=0;b<this.length;b++)if(a.call(this,this[b],b,this))return this[b]}),networkMap.datasource=networkMap.datasource||{},networkMap.registerDatasource=function(a,b){networkMap.datasource[a]=function(a,c){"array"!==typeOf(c)&&(c=[c]),b(a,c)}},networkMap.registerDatasource("simulate",function(a,b){b.each(function(b){var c=Math.random();b.callback({url:a,request:b.data,value:c,realValue:Math.round(100*c)+"Mbps"})})}),networkMap.events=networkMap.events||{click:function(a,b){b.href&&(window.location.href=b.href)},hover:function(a,b){var c=document.id("nm-active-hover");if(c)return c.store("keep",!0),void 0;var d=(a.target.getPosition(),a.target.instance),e=d.getSegment(2),f=d.getSegment(3),g=d.getSegment(5),h=d.getSegment(6),i=((e.coords[0]+h.coords[0])/2+(f.coords[0]+g.coords[0])/2)/2,j=((e.coords[1]+h.coords[1])/2+(f.coords[1]+g.coords[1])/2)/2;c=new Element("div",{id:"nm-active-hover","class":"nm-hover",text:b.name,events:{mouseover:function(){c.store("mouseover",!0)},mouseout:function(){c.eliminate("mouseover"),function(){c.retrieve("keep")?c.eliminate("keep"):c.destroy()}.delay(10)}}}),c.setStyles({top:-1e3,left:-1e3}),document.id(document.body).grab(c);var k=c.getSize();c.setStyles({top:j-k.y/4,left:i-k.x/4})},mouseover:function(){console.log("mouse over")},mouseout:function(){console.log("mouse out")}},networkMap.registerEvent=function(a,b){if(!networkMap.events[a])throw"Invalid event: "+a+" is not an registered event";"click"===a?networkMap.events[a]=function(a){var c=a.target.instance.link.click;b(a,c)}:"hover"===a?(networkMap.events.mouseover=function(a){var c=a.target.instance.link.hover;b(a,c)},networkMap.events.mouseout=function(a){a.target.instance.link.hover;var b=document.id("nm-active-hover");!function(){b&&!b.retrieve("mouseover")&&b.destroy()}.delay(10)}):networkMap.events[a]=b},networkMap.registerEvent("click",networkMap.events.click),networkMap.registerEvent("mouseover",networkMap.events.mouseover),networkMap.registerEvent("mouseout",networkMap.events.mouseout),networkMap.registerEvent("hover",networkMap.events.hover),networkMap.colormap=networkMap.colormap||{},networkMap.registerColormap=function(a,b){networkMap.colormap[a]=b},networkMap.colormap.rasta5={translate:function(a){return a?.2>a?networkMap.colormap.rasta5.map[0]:.4>a?networkMap.colormap.rasta5.map[1]:.6>a?networkMap.colormap.rasta5.map[2]:.8>a?networkMap.colormap.rasta5.map[3]:networkMap.colormap.rasta5.map[4]:networkMap.colormap.rasta5.nodata},map:["#3DDE1E","#9BEC1A","#F9EB18","#F98020","#F51329"],limits:[.2,.4,.6,.8,1],nodata:"#C0C0C0"},networkMap.ColorLegend=new Class({Implements:[Options],options:{boxSize:25,margin:10},initialize:function(a,b){if(this.graph=b.graph,delete b.graph,this.setOptions(b),this.colormap=networkMap.colormap[a],!this.colormap)throw'Colormap "'+a+'" is not registerd';this.graph.addEvent("resize",this.move.bind(this)),this.draw()},draw:function(){var a=this.colormap.map,b=this.svg=this.graph.getSVG().group();a.each(function(c,d){b.rect(this.options.boxSize,this.options.boxSize).attr({fill:c,"stroke-width":1}).move(0,(a.length-1-d)*this.options.boxSize),b.line(-5,(a.length-1-d)*this.options.boxSize,0,(a.length-1-d)*this.options.boxSize).attr({stroke:"#000"}),b.text(100*this.colormap.limits[d].toString()+"%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-1.3-d)*this.options.boxSize,"end")}.bind(this)),b.line(-5,a.length*this.options.boxSize,0,a.length*this.options.boxSize).attr({stroke:"#000"}),b.text("0%").attr({"text-anchor":"end","font-size":this.options.boxSize/2}).move(-this.options.boxSize/2,(a.length-.3)*this.options.boxSize,"end"),this.move()},move:function(a,b){var c;return a&&b||(c=this.graph.element.getSize()),c.x&&c.y&&this.svg.move(c.x-this.options.boxSize-this.options.margin,c.y-this.options.boxSize*this.colormap.map.length-this.options.margin),this}}),networkMap.SettingsManager=new Class({Implements:[Options,Events],options:{},container:null,initialize:function(a){this.container=a,this.nav=this.createMenu(),a.grab(this.nav)},createMenu:function(){var a=new Element("nav",{"class":"nm-menu"}),b=new Element("div",{"class":"nm-trigger",html:'<span class="nm-icon nm-icon-menu"></span><a class="nm-label">Settings</a>',events:{click:this.toggle.bind(this)}}),c=new Element("ul");return c.grab(new Element("li",{html:'<button class="btn btn-primary pull-right">Save</button>',"class":"clearfix",events:{click:this.save.bind(this)}})),a.grab(b),a.grab(c),a},toggle:function(){this.nav.hasClass("nm-menu-open")?this.disable():this.enable()},enable:function(){this.nav.addClass("nm-menu-open"),this.fireEvent("active")},disable:function(){this.nav.removeClass("nm-menu-open"),this.fireEvent("deactive")},save:function(){this.fireEvent("save")}}),networkMap.Graph=new Class({Implements:[Options,Events],options:{width:10,height:10,datasource:"simulate",colormap:"rasta5",enableEditor:!0,allowDraggableNodes:!1},exportedOptions:[],nodes:[],links:[],saveData:{},initialize:function(a,b){this.setOptions(b),this.element=document.id(a),this.container=new Element("div",{"class":"nm-container"}),this.element.grab(this.container),this.graph=SVG(this.container),this.legend=new networkMap.ColorLegend(this.options.colormap,{graph:this}),this.settings=new networkMap.SettingsManager(this.container),this.settings.addEvent("active",this.enableDraggableNodes.bind(this)),this.settings.addEvent("deactive",this.disableDraggableNodes.bind(this)),this.settings.addEvent("save",this.save.bind(this)),this.addEvent("resize",this.rescale.bind(this)),this.triggerEvent("resize",this)},triggerEvent:function(a,b){b.fireEvent(a,b)},rescale:function(){return docSize=this.element.getSize(),this.graph.size(docSize.x,docSize.y),this},getSVG:function(){return this.graph},load:function(a){return"string"===typeOf(a)?this.loadUrl(a):void 0},loadUrl:function(a){return new Request.JSON({url:a,onSuccess:function(a){this.loadObject(a)}.bind(this),onFailure:function(){},onComplete:function(){},onError:function(){}}).get({}),this},loadObject:function(a){return a.nodes.each(function(a){a.graph=this,a.draggable=this.options.allowDraggableNodes,this.addNode(new networkMap.Node(a))}.bind(this)),a.links.each(function(a){a.graph=this,this.addLink(new networkMap.Link(a))}.bind(this)),a.onSave&&this.validateSave(a.onSave)&&(this.saveData=a.onSave),this},validateSave:function(a){return a.method&&"post"!=a.method&&"get"!=a.method?(this.saveEnabled=!1,alert("Illigal argument: "+a.method+". Valid onSave.method arguments are: post, get"),!1):(a.method="post",a.data=a.data||{},a.url?!0:(this.saveEnabled=!1,alert("Missing argument onSave.url"),!1))},save:function(){if(!this.saveData)return!1;var a=this.getConfiguration();a.onSave=this.saveData,console.log(a),new Request.JSON({url:this.saveData.url,method:this.saveData.method,data:a,onSuccess:function(a){console.log(a)}.bind(this),onFailure:function(){},onComplete:function(){},onError:function(){}}).send()},enableDraggableNodes:function(){this.nodes.each(function(a){a.draggable()})},disableDraggableNodes:function(){this.nodes.each(function(a){a.fixed()})},getConfiguration:function(){var a={nodes:[],links:[]};return this.exportedOptions.each(function(b){a[b]=this.options[b]}.bind(this)),this.nodes.each(function(b){a.nodes.push(b.getConfiguration())}),this.links.each(function(b){a.links.push(b.getConfiguration())}),a},addNode:function(a){return this.nodes.push(a),this},getNode:function(a){return this.nodes.find(function(b){return b.options.id===a?!0:void 0})},addLink:function(a){return this.links.push(a),this},update:function(){var a={};this.links.each(function(b){[b.options.nodeA,b.options.nodeB].each(function(b){a[b.requestUrl]||(a[b.requestUrl]=[]),a[b.requestUrl].push(b.requestData)})}),Object.each(a,function(a,b){networkMap.datasource[this.options.datasource](b,a,function(a){console.log(a)})}.bind(this))}}),networkMap.Node=new Class({Implements:[Options,Events],options:{graph:null,id:null,name:null,x:null,y:null,lat:null,lng:null,weight:null,information:{},data:{},label:{position:"internal",visable:!0},renderer:"rect",padding:10,href:null,style:null,debug:!1,draggable:!1},exportedOptions:["id","name","x","y","lat","lng","weight","renderer","information","label","padding","href","style"],initialize:function(a){if(this.graph=a.graph,delete a.graph,this.setOptions(a),!this.options.id)throw"Node(create, no id given)";this.options.x=parseFloat(this.options.x),this.options.y=parseFloat(this.options.y),this.options.padding=parseFloat(this.options.padding),this.graph&&this.draw()},getConfiguration:function(){var a={};return this.exportedOptions.each(function(b){a[b]=this.options[b]}.bind(this)),a},setGraph:function(a){this.graph=null,this.draw(),a&&(this.graph=a,this.draw())},x:function(){return this.svg.bbox().x},y:function(){return this.svg.bbox().y},draggable:function(){this.svg.draggable(),this.svg.style("cursor","move")},fixed:function(){this.svg.fixed(),this.svg.style("cursor","default")},bbox:function(){return this.svg.bbox()},draw:function(){if(this.svg&&!this.graph)return this.svg.remove(),!1;if(!this.graph)return!1;this.debug&&this.debug.remove(),this.options.debug&&(this.debug=this.graph.getSVG().group());var a=this.svg=this.graph.getSVG().group(),b=a.text(this.options.name).font({family:"Helvetica",size:16,anchor:"start",leading:1.2}).move(this.options.padding,this.options.padding),c=b.bbox(),d=a.rect(1,1).fill({color:"#ddd"}).stroke({color:"#000",width:2}).attr({rx:4,ry:4}).size(c.width+2*this.options.padding,c.height+2*this.options.padding);return b.front(),d.clone().fill({opacity:0}).front(),a.move(this.options.x,this.options.y),this.options.draggable&&this.draggable(),a.dragmove=function(a,b){this.fireEvent("drag",[a,b])}.bind(this),a.dragstart=function(){this.fireEvent("dragstart")}.bind(this),a.dragend=function(){this.options.x=this.x(),this.options.y=this.y(),this.fireEvent("dragend")}.bind(this),!0}}),networkMap.Node.renderer=networkMap.Node.renderer||{},networkMap.registerNodeRenderer=function(a,b){networkMap.Node.renderer[a]=b},networkMap.Node.renderer.rect=function(){},networkMap.Node.label=networkMap.Node.label||{},networkMap.Node.label.rederer=networkMap.Node.label.rederer||{},networkMap.Node.label.rederer.normal=function(){},networkMap.Link=new Class({Implements:[Options],options:{inset:10,connectionDistance:10,staticConnectionDistance:30,arrowHeadLength:10,width:10,debug:!0,background:"#777",localUpdate:!0,refreshInterval:3e5,datasource:null,colormap:networkMap.colormap.rasta5},exportedOptions:["inset","connectionDistance","staticConnectionDistance","arrowHeadLength","width","background","nodeA","nodeB"],pathPoints:[],svgEl:{},updateQ:{},initialize:function(a){if(this.graph=a.graph,a.graph=null,this.setOptions(a),this.options.datasource=this.options.datasource||this.graph.options.datasource,this.datasource=networkMap.datasource[this.options.datasource],!this.options.nodeA||!this.options.nodeB)throw"Link(create, missing node in link definition)";if(this.nodeA=this.graph.getNode(this.options.nodeA.id),!this.nodeA)throw"Link(create, nodeA does not exist ("+this.options.nodeA.id+")";if((this.options.nodeA.requestData||this.options.nodeA.sublinks)&&(this.svgEl.nodeA={},this.options.nodeA.sublinks&&(this.svgEl.nodeA.sublinks=[])),this.nodeB=this.graph.getNode(this.options.nodeB.id),!this.nodeA)throw"Link(create, nodeB does not exist ("+this.options.nodeB.id+")";(this.options.nodeB.requestData||this.options.nodeB.sublinks)&&(this.svgEl.nodeB={},this.options.nodeB.sublinks&&(this.svgEl.nodeB.sublinks=[])),this.graph&&this.draw()},getConfiguration:function(){var a={};return this.exportedOptions.each(function(b){a[b]=this.options[b]}.bind(this)),a},setGraph:function(a){this.graph=null,this.draw(),a&&(this.graph=a,this.draw())},_cleanDebugLayer:function(){this.debug&&this.debug.clear(),this.options.debug&&!this.debug&&(this.debug=this.graph.getSVG().group())},draw:function(){if(this.svg&&!this.graph)return this.svg.remove(),!1;if(!this.graph)return!1;this._cleanDebugLayer();var a=this.svg=this.graph.getSVG().group();a.back(),this.nodeA.bbox(),this.nodeB.bbox(),this.shadowPath=a.path().attr({fill:"none",stroke:"#000","stroke-dasharray":"3,5","stroke-width":2}),this.redrawShadowPath(),this.drawMainPath(),this.drawSublinks(),this.localUpdate(),this.nodeA.addEvent("drag",function(){this._cleanDebugLayer(),this.redrawShadowPath()}.bind(this)),this.nodeB.addEvent("drag",function(){this._cleanDebugLayer(),this.redrawShadowPath()}.bind(this)),this.nodeA.addEvent("dragstart",function(){this.hidePaths()}.bind(this)),this.nodeB.addEvent("dragstart",function(){this.hidePaths()}.bind(this)),this.nodeA.addEvent("dragend",function(){this.drawMainPath(),this.drawSublinks(),this.showPaths()}.bind(this)),this.nodeB.addEvent("dragend",function(){this.drawMainPath(),this.drawSublinks(),this.showPaths()}.bind(this))},redrawShadowPath:function(){this.pathPoints.length=0,networkMap.Point;var a=this.nodeA.bbox(),b=this.nodeB.bbox(),c=SVG.math.angle(a,b);return c=SVG.math.snapToAngle(c,[0,Math.PI/2,Math.PI,3*Math.PI/2]),this.options.inset?this.pathPoints.push(new SVG.math.Point(-this.options.inset*Math.cos(c)+a.cx+Math.cos(c)*a.width/2,-this.options.inset*Math.sin(c)+a.cy+Math.sin(c)*a.height/2)):this.pathPoints.push(new SVG.math.Point(a.cx,a.cy)),this.pathPoints.push(new SVG.math.Point(this.options.connectionDistance*Math.cos(c)+a.cx+Math.cos(c)*a.width/2,this.options.connectionDistance*Math.sin(c)+a.cy+Math.sin(c)*a.height/2)),this.pathPoints.push(new SVG.math.Point(this.options.staticConnectionDistance*Math.cos(c)+a.cx+Math.cos(c)*a.width/2,this.options.staticConnectionDistance*Math.sin(c)+a.cy+Math.sin(c)*a.height/2)),this.pathPoints.push(new SVG.math.Point(-this.options.staticConnectionDistance*Math.cos(-c)+b.cx-Math.cos(-c)*b.width/2,this.options.staticConnectionDistance*Math.sin(-c)+b.cy+Math.sin(-c)*b.height/2)),this.pathPoints.push(new SVG.math.Point(-this.options.connectionDistance*Math.cos(-c)+b.cx-Math.cos(-c)*b.width/2,this.options.connectionDistance*Math.sin(-c)+b.cy+Math.sin(-c)*b.height/2)),this.options.inset?this.pathPoints.push(new SVG.math.Point(this.options.inset*Math.cos(-c)+b.cx-Math.cos(-c)*b.width/2,-this.options.inset*Math.sin(-c)+b.cy+Math.sin(-c)*b.height/2)):this.pathPoints.push(new SVG.math.Point(b.cx,b.cy)),this.shadowPath.clear().M(this.pathPoints[0]).L(this.pathPoints[2]).L(this.pathPoints[3]).L(this.pathPoints[5]),this},removeMainPath:function(){this.mainPathA&&this.mainPathA.remove(),this.mainPathB&&this.mainPathB.remove()},hidePaths:function(){function a(a){a.mainPath&&a.mainPath.hide(),a.sublinks&&a.sublinks.each(function(a){a.hide()})}return this.svgEl.nodeA&&a(this.svgEl.nodeA),this.svgEl.nodeB&&a(this.svgEl.nodeB),this},showPaths:function(){function a(a){a.mainPath&&a.mainPath.show(),a.sublinks&&a.sublinks.each(function(a){a.show()})}return this.svgEl.nodeA&&a(this.svgEl.nodeA),this.svgEl.nodeB&&a(this.svgEl.nodeB),this},drawMainPath:function(){var a=1;this.options.sublinks&&(a=this.options.sublinks.length);var b=new SVG.math.Line(this.pathPoints[0],this.pathPoints[2]),c=new SVG.math.Line(this.pathPoints[2],this.pathPoints[3]);new SVG.math.Line(this.pathPoints[3],this.pathPoints[5]);var d=b.perpendicularLine(this.pathPoints[1],a*this.options.width),e=b.perpendicularLine(this.pathPoints[2],a*this.options.width),f=c.perpendicularLine(this.pathPoints[2],a*this.options.width),g=c.midPoint(),h=c.move(g,c.p1,this.options.arrowHeadLength),i=c.move(g,c.p2,this.options.arrowHeadLength),j=c.perpendicularLine(h,a*this.options.width),k=new SVG.math.Line(d.p1,e.p1),l=new SVG.math.Line(f.p1,j.p1),m=l.intersection(k);m.parallel===!0&&(m=d.p1),k=new SVG.math.Line(d.p2,e.p2),l=new SVG.math.Line(f.p2,j.p2);var n=l.intersection(k);if(n.parallel===!0&&(n=d.p2),!this.svgEl.nodeA.mainPath){var o=this.svgEl.nodeA.mainPath=networkMap.path(this.svg);this.registerUpdateEvent(this.options.datasource,this.options.nodeA.requestUrl,this.options.nodeA.requestData,function(a){this.updateBgColor(o,this.options.colormap.translate(a.value))}.bind(this))}if(this.svgEl.nodeA.mainPath.clear(),this.svgEl.nodeA.mainPath.M(this.pathPoints[0]).L(d.p1).L(m).L(j.p1).L(g).L(j.p2).L(n).L(d.p2).Z(),this.options.nodeA.events&&(this.svgEl.nodeA.mainPath.link=this.options.nodeA.events,this.options.nodeA.events.click&&this.svgEl.nodeA.mainPath.on("click",networkMap.events.click),this.options.nodeA.events.hover&&(this.svgEl.nodeA.mainPath.on("mouseover",networkMap.events.mouseover),this.svgEl.nodeA.mainPath.on("mouseout",networkMap.events.mouseout))),d=b.perpendicularLine(this.pathPoints[4],a*this.options.width),e=b.perpendicularLine(this.pathPoints[3],a*this.options.width),f=c.perpendicularLine(this.pathPoints[3],a*this.options.width),j=c.perpendicularLine(i,a*this.options.width),k=new SVG.math.Line(d.p1,e.p1),l=new SVG.math.Line(f.p1,j.p1),m=l.intersection(k),m.parallel===!0&&(m=f.p1),k=new SVG.math.Line(d.p2,e.p2),l=new SVG.math.Line(f.p2,j.p2),n=l.intersection(k),n.parallel===!0&&(n=e.p2),!this.svgEl.nodeB.mainPath){var p=this.svgEl.nodeB.mainPath=networkMap.path(this.svg);this.registerUpdateEvent(this.options.datasource,this.options.nodeB.requestUrl,this.options.nodeB.requestData,function(a){this.updateBgColor(p,this.options.colormap.translate(a.value))}.bind(this))}return this.svgEl.nodeB.mainPath.clear(),this.svgEl.nodeB.mainPath.M(this.pathPoints[5]).L(d.p1).L(m).L(j.p1).L(g).L(j.p2).L(n).L(d.p2).Z(),this.options.nodeB.events&&(this.svgEl.nodeB.mainPath.link=this.options.nodeB.events,this.options.nodeB.events.click&&this.svgEl.nodeB.mainPath.on("click",networkMap.events.click),this.options.nodeB.events.hover&&(this.svgEl.nodeB.mainPath.on("mouseover",networkMap.events.mouseover),this.svgEl.nodeB.mainPath.on("mouseout",networkMap.events.mouseout))),this},drawSublinks:function(){var a,b,c,d,e,f=function(d,f,g){for(var h=0,i=function(a,b){return function(a){this.updateBgColor(b,this.options.colormap.translate(a.value))}.bind(a)};c>=-a/2;){var j={width:e},k=this.calculateSublinkPath(g,c,j);b&&(d.sublinks[h]||(d.sublinks[h]=networkMap.path(this.svg),this.registerUpdateEvent(this.options.datasource,this.options.nodeB.requestUrl,this.options.nodeB.requestData,i(this,d.sublinks[h]))),d.sublinks[h].clear(),c===-.5?d.sublinks[h].M(f).L(b[0]).L(b[1]).L(b[2]).L(g[g.length-1]).L(k[2]).L(k[1]).L(k[0]).Z().front():d.sublinks[h].M(f).L(b[0]).L(b[1]).L(b[2]).L(k[2]).L(k[1]).L(k[0]).Z().front(),h+=1),b=k,c-=1}}.bind(this);return this.options.nodeA.sublinks&&(a=this.options.nodeA.sublinks.length,b=null,c=a/2,d=[this.pathPoints[0],this.pathPoints[1],this.pathPoints[2],new SVG.math.Line(this.pathPoints[2],this.pathPoints[3]).midPoint()],e=this.options.nodeA.width||this.options.width,f(this.svgEl.nodeA,this.pathPoints[0],d)),this.options.nodeB.sublinks&&(a=this.options.nodeB.sublinks.length,b=null,c=a/2,d=[this.pathPoints[5],this.pathPoints[4],this.pathPoints[3],new SVG.math.Line(this.pathPoints[3],this.pathPoints[2]).midPoint()],e=this.options.nodeB.width||this.options.width,f(this.svgEl.nodeB,this.pathPoints[5],d)),this},calculateSublinkPath:function(a,b,c){var d=c.width||this.options.width,e=d*b,f=Math.abs(this.options.arrowHeadLength*b*(d/this.options.width)),g=new SVG.math.Line(a[0],a[2]),h=new SVG.math.Line(a[2],a[3]),i=g.perpendicularLine(a[1],e),j=g.perpendicularLine(a[2],e),k=h.perpendicularLine(a[2],e),l=h.move(h.p2,h.p1,f),m=h.perpendicularLine(l,e),n=new SVG.math.Line(i.p1,j.p1),o=new SVG.math.Line(k.p1,m.p1),p=o.intersection(n);return p.parallel===!0&&(p=i.p1),[i.round(2).p1,p.round(2),m.round(2).p1]},setInterval:function(){this.intervalId=setInterval(function(){this.localUpdate()}.bind(this),this.options.refreshInterval)},clearInterval:function(){return this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId),this},registerUpdateEvent:function(a,b,c,d){this.updateQ[a]||(this.updateQ[a]={}),this.updateQ[a][b]||(this.updateQ[a][b]=[]),this.updateQ[a][b].push({data:c,callback:d})},localUpdate:function(){Object.each(this.updateQ,function(a,b){if(!networkMap.datasource[b])throw"Unknown datasource ("+b+")";Object.each(a,function(a,c){this.options.batchUpdate?networkMap.datasource[b](c,a):a.each(function(a){networkMap.datasource[b](c,a)})}.bind(this))}.bind(this))},update:function(){return this.svgEl.nodeA.mainPath&&this.datasource(this.options.nodeA.requestUrl,this.options.nodeA.requestData,function(a){this.updateBgColor(this.svgEl.nodeA.mainPath,this.options.colormap.translate(a.value))}.bind(this)),this.svgEl.nodeA.mainPath&&this.datasource(this.options.nodeB.requestUrl,this.options.nodeB.requestData,function(a){this.updateBgColor(this.svgEl.nodeB.mainPath,this.options.colormap.translate(a.value))}.bind(this)),this.options.nodeA.sublinks&&this.options.nodeA.sublinks.each(function(a,b){this.datasource(this.options.nodeA.sublinks[b].requestUrl,this.options.nodeA.sublinks[b].requestData,function(a){this.updateBgColor(this.svgEl.nodeA.sublinks[b],this.options.colormap.translate(a.value))}.bind(this))}.bind(this)),this.options.nodeB.sublinks&&this.options.nodeB.sublinks.each(function(a,b){this.datasource(this.options.nodeB.sublinks[b].requestUrl,this.options.nodeB.sublinks[b].requestData,function(a){this.updateBgColor(this.svgEl.nodeB.sublinks[b],this.options.colormap.translate(a.value))}.bind(this))}.bind(this)),this},updateBgColor:function(a,b){b?a.fill(b):a.fill(this.options.background)}});